import{a as Pe,b as Ae,c as Ne,d as At}from"./chunk-IAWJUBHW.js";import{a as K,b as Q,c as be,d as ee,e as ie,f as Ft,g as kt,h as $t,i as ne,j as Bt}from"./chunk-DXCHC2D2.js";import{a as J,b as _t}from"./chunk-4DUNT3H5.js";import"./chunk-A3ALBLIS.js";import"./chunk-GMITE7GY.js";import"./chunk-JINNKTRQ.js";import{p as Nt}from"./chunk-JXCPYOSY.js";import{$ as b,$b as X,Ac as Ot,B as dt,Bc as Lt,Cc as yt,Dc as N,E as v,Ec as F,F as D,Fa as pt,Fc as k,Ha as a,Hc as $,Ia as W,Ic as B,Ja as c,Ka as he,Kc as H,La as le,Lc as j,Ma as ce,Na as se,Nc as q,Oc as U,Qc as z,R as l,Ra as y,Rc as Vt,S as w,Sc as Rt,Ta as P,Tc as lt,Ua as A,Vc as wt,Y as _,Zb as bt,a as De,aa as Le,b as xe,bb as ut,bc as vt,cb as ft,cc as Dt,db as Y,dc as xt,ea as p,ec as we,ed as V,f as oe,fb as Z,fc as Et,fd as Pt,g as st,ga as mt,h as R,ha as M,hb as gt,ia as O,j as Ee,ja as ye,jc as me,ka as Ve,kb as Ct,la as Re,lc as fe,ma as m,mb as _e,na as o,nc as te,oa as n,ob as de,oc as It,pa as C,pb as ht,qa as f,qb as rt,qc as pe,r as E,ra as g,rc as Tt,t as Ce,ta as x,tc as St,uc as Mt,va as h,wa as u,y as Me,z as Oe}from"./chunk-26SCTFAY.js";var S=class e{constructor(t){this.http=t}apiUrl=`${lt.apiUrl}/api/distribucion`;getOrdenesDistribucion(){return this.http.get(`${this.apiUrl}/ordenes`).pipe(R(t=>t.data.map(i=>({id:i.id,fechaDistribucion:i.fechaDistribucion,idRequerimiento:i.idRequerimiento,estado:i.estado,prioridad:i.prioridad}))))}getDetallesOrdenParaAsignacion(t){return Ee({detalles:this.http.get(`${this.apiUrl}/ordenes/${t}/detalles`),vehiculos:this.http.get(`${this.apiUrl}/vehiculos/disponibles`)}).pipe(R(({detalles:i,vehiculos:r})=>{let s=r.data.map(d=>({id:d.id,placa:d.placa,marca:d.marca,modelo:d.modelo,tipoVehiculo:d.tipoVehiculo,estado:d.estado,disponible:!0}));return i.data.map(d=>({idLote:d.idLote.id,nombreProducto:d.idProducto.nombreProducto,cantidadProducto:d.cantidad,condicionTransporteRequerida:"Ambiente",idVehiculoAsignado:null,opcionesVehiculo:s}))}))}guardarAsignacionVehiculos(t,i){let r=new Map;i.forEach(d=>{d.idVehiculoAsignado&&(r.has(d.idVehiculoAsignado)||r.set(d.idVehiculoAsignado,[]),r.get(d.idVehiculoAsignado)?.push(d))});let s=[];return r.forEach((d,G)=>{let T={idVehiculo:G,idOrdenDist:t,ubicacionActual:"Almac\xE9n Central",proximoDestino:"Destino Final",estimadoLlegada:new Date().toISOString(),idUsuarioActualizacion:1,detallesTransporte:d.map(ct=>({idLote:ct.idLote,cantidad:ct.cantidadProducto}))};s.push(this.http.post(`${this.apiUrl}/seguimientos`,T))}),s.length===0?oe(void 0):Ee(s).pipe(R(()=>{}))}getSeguimientoVehiculos(){return this.http.get(`${this.apiUrl}/vehiculos/en-camino`).pipe(R(t=>t.data.map(i=>({id:i.id,idVehiculo:i.idVehiculo,idOrdenDistId:i.idOrdenDistId,estadoActual:i.estadoActual,ubicacionActual:i.ubicacionActual,fechaHoraActualizacion:i.fechaHoraActualizacion,proximoDestino:i.proximoDestino}))))}getLotesBySeguimientoId(t){return this.http.get(`${this.apiUrl}/seguimientos/${t}/lotes`).pipe(R(i=>i.data.map(r=>({idLote:r.idLote.id,nombreProducto:r.idLote.numeroLote,cantidadTransportada:r.cantidad,incidenciaReportada:!1}))))}getInfoLote(t){return this.http.get(`${lt.apiUrl}/api/almacenamiento/lotes/${t}`).pipe(R(i=>{let r=i.data;return{idLote:r.id,idProducto:r.idProducto.id,numeroLote:r.numeroLote,cantInicial:r.cantidadInicial,cantActual:r.cantidadActual,fechaFabricacion:r.fechaFabricacion,fechaVencimiento:r.fechaVencimiento,estado:r.estado}}))}getInfoVehiculo(t){return this.http.get(`${this.apiUrl}/vehiculos/disponibles`).pipe(R(i=>{let r=i.data.find(s=>s.id===t);if(!r)throw new Error(`Veh\xEDculo ${t} no encontrado`);return{id:r.id,placa:r.placa,marca:r.marca,modelo:r.modelo,tipoVehiculo:r.tipoVehiculo,estado:r.estado,disponible:r.estado==="Disponible"}}))}confirmarEntrega(t){return this.http.put(`${this.apiUrl}/ordenes/${t}/entregar`,{}).pipe(R(()=>{}))}cancelarOrden(t){return this.http.put(`${this.apiUrl}/ordenes/${t}/cancelar`,{}).pipe(R(()=>{}))}getDetalleReporteOrden(t){return Ee({ordenes:this.getOrdenesDistribucion(),detalles:this.http.get(`${this.apiUrl}/ordenes/${t}/detalles`),seguimientos:this.getSeguimientoVehiculos()}).pipe(R(({ordenes:i,detalles:r,seguimientos:s})=>{let d=i.find(T=>T.id===t);if(!d)throw new Error(`Orden ${t} no encontrada`);let G=s.filter(T=>T.idOrdenDistId===t);return{idOrden:d.id,fechaDistribucion:d.fechaDistribucion,estado:d.estado,prioridad:d.prioridad,detalles:r.data.map(T=>({idProducto:T.idProducto.id,nombreProducto:T.idProducto.nombreProducto,cantidad:T.cantidad,idLote:T.idLote.id,numeroLote:T.idLote.numeroLote,estadoEntrega:T.estadoEntrega})),seguimientos:G.map(T=>({idVehiculo:T.idVehiculo.id,placa:T.idVehiculo.placa,estadoActual:T.estadoActual,ubicacionActual:T.ubicacionActual})),totalLotes:r.data.length}}))}getIncidenciasByOrdenId(t){return this.getSeguimientoVehiculos().pipe(Ce(i=>{let r=i.filter(G=>G.idOrdenDistId===t);if(r.length===0)return oe([]);let d=[...new Set(r.map(G=>G.idVehiculo.id))].map(G=>this.getIncidenciasByVehiculo(G));return Ee(d).pipe(R(G=>G.flat()))}))}getReporteOrdenesEntregadas(){return this.getOrdenesDistribucion().pipe(R(t=>t.filter(i=>i.estado==="Entregada").map(i=>xe(De({},i),{totalLotes:0,tieneIncidencias:!1}))))}getIncidenciasByVehiculo(t){return this.http.get(`${this.apiUrl}/vehiculos/${t}/incidencias`).pipe(R(i=>i.data.map(r=>({id:r.id,idVehiculo:r.idVehiculo.id,placaVehiculo:r.idVehiculo.placa,tipoIncidencia:r.tipoIncidencia,descripcion:r.descripcion,estado:r.estado,fechaIncidencia:r.fechaIncidencia,usuarioReporta:r.idUsuarioReportaNombreUsuario||"N/A"}))))}registrarIncidencia(t){return this.http.post(`${this.apiUrl}/incidencias`,t).pipe(R(()=>{}))}static \u0275fac=function(i){return new(i||e)(dt(Ct))};static \u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})};function qt(e,t){if(e&1&&(o(0,"div")(1,"mat-card",9)(2,"h3"),a(3,"Informaci\xF3n Principal"),n(),o(4,"p")(5,"strong"),a(6,"ID:"),n(),a(7),n(),o(8,"p")(9,"strong"),a(10,"Placa:"),n(),a(11),n(),o(12,"p")(13,"strong"),a(14,"Disponibilidad:"),n(),o(15,"span"),a(16),n()(),C(17,"mat-divider",10),o(18,"h3"),a(19,"Detalles T\xE9cnicos"),n(),o(20,"p")(21,"strong"),a(22,"Tipo:"),n(),a(23),n(),o(24,"p")(25,"strong"),a(26,"Capacidad:"),n(),a(27),n(),o(28,"p")(29,"strong"),a(30,"Condici\xF3n de Transporte:"),n(),a(31),n()()()),e&2){let i=u();l(7),c(" #",i.vehiculo.id),l(4),c(" ",i.vehiculo.placa),l(4),pt("text-green-600",i.vehiculo.disponible)("text-red-600",!i.vehiculo.disponible),l(),c(" ",i.vehiculo.disponible?"DISPONIBLE":"EN USO / NO DISPONIBLE"," "),l(7),c(" ",i.vehiculo.tipoVehiculo),l(4),c(" ",i.vehiculo.capacidad," Toneladas/M\xB3"),l(4),c(" ",i.vehiculo.condicionTransporte)}}function Ut(e,t){e&1&&(o(0,"div",11)(1,"p"),a(2,"No se encontraron detalles para el veh\xEDculo especificado."),n()())}var Fe=class e{constructor(t,i,r){this.dialogRef=t;this.data=i;this.distribucionService=r}vehiculo=null;isLoading=!0;ngOnInit(){this.cargarInfoVehiculo(this.data.idVehiculo)}cargarInfoVehiculo(t){this.isLoading=!0,this.distribucionService.getInfoVehiculo(t).pipe(E(()=>this.isLoading=!1)).subscribe({next:i=>{this.vehiculo=i},error:i=>{console.error("Error al cargar informaci\xF3n del veh\xEDculo:",i),alert("Error al cargar la informaci\xF3n del veh\xEDculo.")}})}onClose(){this.dialogRef.close()}static \u0275fac=function(i){return new(i||e)(_(K),_(Q),_(S))};static \u0275cmp=b({type:e,selectors:[["app-popup-info-vehiculo"]],standalone:!1,decls:12,vars:3,consts:[["color","primary"],[1,"dialog-title"],[1,"spacer"],["mat-icon-button","",3,"click"],["mat-dialog-content","",1,"dialog-content"],[4,"ngIf"],["class","empty-state centered-content",4,"ngIf"],["mat-dialog-actions","","align","end"],["mat-raised-button","","color","primary",3,"click"],[1,"info-card"],[1,"my-3"],[1,"empty-state","centered-content"]],template:function(i,r){i&1&&(o(0,"mat-toolbar",0)(1,"span",1),a(2),n(),C(3,"span",2),o(4,"button",3),h("click",function(){return r.onClose()}),a(5," Cerrar "),n()(),o(6,"div",4),p(7,qt,32,10,"div",5)(8,Ut,3,0,"div",6),n(),o(9,"div",7)(10,"button",8),h("click",function(){return r.onClose()}),a(11,"Cerrar"),n()()),i&2&&(l(2),c(" Detalles del Veh\xEDculo N\xB0 ",r.data.idVehiculo," "),l(5),m("ngIf",!r.isLoading&&r.vehiculo),l(),m("ngIf",!r.isLoading&&!r.vehiculo))},dependencies:[ie,ee,J,Y,X,bt,V,we],encapsulation:2})};var ke=class e{constructor(t,i){this.dialogRef=t;this.data=i}onConfirmar(){this.dialogRef.close({confirmado:!0})}onCancelar(){this.dialogRef.close({confirmado:!1})}static \u0275fac=function(i){return new(i||e)(_(K),_(Q))};static \u0275cmp=b({type:e,selectors:[["app-popup-confirmacion-entrega"]],standalone:!1,decls:21,vars:3,consts:[["color","warn"],[1,"dialog-title"],[1,"spacer"],[3,"click"],["mat-dialog-content","",1,"dialog-content"],[1,"message-area"],["mat-dialog-actions","","align","end"],["mat-button","","type","button","color","default",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(i,r){i&1&&(o(0,"mat-toolbar",0)(1,"span",1),a(2),n(),C(3,"span",2),o(4,"button",3),h("click",function(){return r.onCancelar()}),a(5," Cerrar "),n()(),o(6,"div",4)(7,"div",5)(8,"p"),a(9),n(),o(10,"p")(11,"strong"),a(12,"\xCDtem:"),n(),a(13),n(),o(14,"p"),a(15,"\xBFDesea continuar con esta acci\xF3n?"),n()()(),o(16,"div",6)(17,"button",7),h("click",function(){return r.onCancelar()}),a(18," Cancelar "),n(),o(19,"button",8),h("click",function(){return r.onConfirmar()}),a(20," Confirmar Entrega "),n()()),i&2&&(l(2),W(r.data.titulo),l(7),W(r.data.mensaje),l(4),c(" ",r.data.itemNombre))},dependencies:[ie,ee,J,X],encapsulation:2})};var $e=class e{crearIncidencia(t){return console.log("[IncidenciaService] Registrando nueva incidencia:",t),t.descripcion.length<5?st(()=>new Error("La descripci\xF3n debe ser m\xE1s detallada.")):oe({success:!0})}static \u0275fac=function(i){return new(i||e)};static \u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})};function Wt(e,t){if(e&1&&(o(0,"mat-option",10),a(1),n()),e&2){let i=u(2);m("value",i.f.idDetalleDist.value),l(),c(" LOTE PRESELECCIONADO: #",i.f.idDetalleDist.value," ")}}function Yt(e,t){if(e&1&&(o(0,"mat-option",10),a(1),n()),e&2){let i=t.$implicit;m("value",i),l(),c("LOTE: #",i)}}function Zt(e,t){e&1&&(o(0,"mat-option",18),a(1,"No hay lotes en esta orden."),n()),e&2&&m("disabled",!0)}function Jt(e,t){if(e&1&&(Ve(0,Yt,2,2,"mat-option",10,ye),M(2,Zt,2,1,"mat-option",18)),e&2){let i=u(2);Re(i.lotesDisponibles),l(2),O(i.lotesDisponibles.length===0?2:-1)}}function Xt(e,t){e&1&&(o(0,"mat-error"),a(1,"Debe seleccionar un lote afectado."),n())}function Kt(e,t){if(e&1&&(o(0,"div",7)(1,"h4"),a(2,"Lote Afectado *"),n(),o(3,"mat-select",17),M(4,Wt,2,2,"mat-option",10)(5,Jt,3,1),n(),p(6,Xt,2,0,"mat-error",11),n()),e&2){let i=u();l(3),m("disabled",i.f.idDetalleDist.disabled),l(),O(i.f.idDetalleDist.disabled?4:5),l(2),m("ngIf",i.f.idDetalleDist.hasError("required"))}}function Qt(e,t){if(e&1&&(o(0,"mat-option",10),a(1),n()),e&2){let i=t.$implicit;m("value",i),l(),W(i)}}function ei(e,t){e&1&&(o(0,"mat-error"),a(1,"El tipo es obligatorio."),n())}function ti(e,t){if(e&1&&(o(0,"mat-option",10),a(1),n()),e&2){let i=t.$implicit;m("value",i),l(),W(i)}}function ii(e,t){e&1&&(o(0,"mat-error"),a(1,"El impacto es obligatorio."),n())}function ni(e,t){e&1&&(o(0,"mat-error"),a(1,"La descripci\xF3n es obligatoria."),n())}var Be=class e{constructor(t,i,r,s){this.dialogRef=t;this.data=i;this.fb=r;this.incidenciaService=s}incidenciaForm;isLoading=!1;tiposIncidencia=["Accidente","Tr\xE1fico","Aver\xEDa Mec\xE1nica","Retraso Log\xEDstico","Problema de Carga/Descarga"];nivelesImpacto=["Bajo","Moderado","Alto"];lotesDisponibles=[];ngOnInit(){this.lotesDisponibles=this.data.lotesDisponibles||[],this.initForm(),this.incidenciaForm.get("problemaConLote")?.valueChanges.subscribe(t=>{this.toggleLoteField(t)})}toggleLoteField(t){let i=this.incidenciaForm.get("idDetalleDist");t?i?.setValidators([fe.required]):(i?.clearValidators(),i?.setValue(null)),i?.updateValueAndValidity()}initForm(){let t=this.data.idDetalleDist?[fe.required]:[],i=!!this.data.idDetalleDist;this.incidenciaForm=this.fb.group({idVehiculo:[{value:this.data.idVehiculo,disabled:!0}],idOrdenDist:[{value:this.data.idOrdenDist,disabled:!0}],problemaConLote:[i],idDetalleDist:[{value:this.data.idDetalleDist,disabled:!0},t],tipoIncidencia:["",fe.required],descripcion:["",[fe.required,fe.maxLength(500)]],impacto:["",fe.required]})}onSubmit(){if(this.incidenciaForm.updateValueAndValidity(),this.incidenciaForm.invalid){this.incidenciaForm.markAllAsTouched();return}let t=this.incidenciaForm.getRawValue(),i=t.problemaConLote?t.idDetalleDist:null,r={idVehiculo:t.idVehiculo,idOrdenDist:t.idOrdenDist,idUsuarioReporta:this.data.idUsuarioReporta,tipoIncidencia:t.tipoIncidencia,descripcion:t.descripcion,impacto:t.impacto,idDetalleDist:i};this.isLoading=!0,this.incidenciaService.crearIncidencia(r).pipe(E(()=>this.isLoading=!1)).subscribe({next:()=>{this.dialogRef.close({success:!0})},error:s=>{console.error("Error al registrar incidencia:",s),alert(`Error al registrar la incidencia: ${s.message||"Error de conexi\xF3n"}`)}})}onCancel(){this.dialogRef.close({success:!1})}get f(){return this.incidenciaForm.controls}static \u0275fac=function(i){return new(i||e)(_(K),_(Q),_(Ot),_($e))};static \u0275cmp=b({type:e,selectors:[["app-popup-crear-incidencia"]],standalone:!1,decls:39,vars:10,consts:[["color","warn"],[1,"dialog-title"],[1,"spacer"],[3,"click","disabled"],[1,"dialog-form",3,"ngSubmit","formGroup"],["mat-dialog-content","",1,"form-content"],[1,"mb-4","font-semibold","text-lg","border-b","pb-2"],[1,"form-field-group","full-width"],["formControlName","problemaConLote","color","warn",1,"status-checkbox"],["formControlName","tipoIncidencia"],[3,"value"],[4,"ngIf"],["formControlName","impacto"],["formControlName","descripcion","type","text"],["mat-dialog-actions","","align","end"],["type","button",3,"click","disabled"],["color","warn","type","submit",3,"disabled"],["formControlName","idDetalleDist",3,"disabled"],[3,"disabled"]],template:function(i,r){i&1&&(o(0,"mat-toolbar",0)(1,"span",1),a(2," Registrar Incidencia de Transporte "),n(),C(3,"span",2),o(4,"button",3),h("click",function(){return r.onCancel()}),a(5," Cerrar "),n()(),o(6,"form",4),h("ngSubmit",function(){return r.onSubmit()}),o(7,"div",5)(8,"h4",6),a(9),n(),o(10,"div",7)(11,"mat-checkbox",8),a(12," \xBFLa incidencia est\xE1 asociada a un Lote espec\xEDfico? "),n()(),M(13,Kt,7,3,"div",7),o(14,"div",7)(15,"h4"),a(16,"Tipo de Incidencia *"),n(),o(17,"div")(18,"mat-select",9),Ve(19,Qt,2,2,"mat-option",10,ye),n(),p(21,ei,2,0,"mat-error",11),n()(),o(22,"div",7)(23,"h4"),a(24,"Nivel de Impacto *"),n(),o(25,"mat-select",12),Ve(26,ti,2,2,"mat-option",10,ye),n(),p(28,ii,2,0,"mat-error",11),n(),o(29,"div",7)(30,"h4"),a(31,"Descripci\xF3n del Problema *"),n(),C(32,"input",13),p(33,ni,2,0,"mat-error",11),n()(),o(34,"div",14)(35,"button",15),h("click",function(){return r.onCancel()}),a(36," Cancelar "),n(),o(37,"button",16),a(38," Registrar "),n()()()),i&2&&(l(4),m("disabled",r.isLoading),l(2),m("formGroup",r.incidenciaForm),l(3),he("Orden #",r.data.idOrdenDist," | Veh\xEDculo #",r.data.idVehiculo),l(4),O(r.f.problemaConLote.value?13:-1),l(6),Re(r.tiposIncidencia),l(2),m("ngIf",r.f.tipoIncidencia.hasError("required")),l(5),Re(r.nivelesImpacto),l(2),m("ngIf",r.f.impacto.hasError("required")),l(5),m("ngIf",r.f.descripcion.hasError("required")),l(2),m("disabled",r.isLoading),l(2),m("disabled",r.incidenciaForm.invalid||r.isLoading))},dependencies:[kt,ie,ee,J,Pe,Y,Tt,me,te,It,St,Mt,wt,Ne],encapsulation:2})};var oi=()=>[];function ai(e,t){e&1&&(o(0,"th",18),a(1," Seg. N\xB0 "),n())}function ri(e,t){if(e&1&&(o(0,"td",19),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.idSeguimiento," ")}}function li(e,t){e&1&&(o(0,"th",18),a(1," Orden N\xB0 "),n())}function ci(e,t){if(e&1&&(o(0,"td",19),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.idOrden," ")}}function si(e,t){e&1&&(o(0,"th",18),a(1," Veh\xEDculo "),n())}function di(e,t){if(e&1&&(o(0,"td",19),a(1),n()),e&2){let i=t.$implicit;l(),he(" **#",i.idVehiculo," (",i.placaVehiculo,")** ")}}function mi(e,t){e&1&&(o(0,"th",18),a(1," Estado Actual "),n())}function pi(e,t){if(e&1&&(o(0,"td",19),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.estadoActual," ")}}function ui(e,t){e&1&&(o(0,"th",18),a(1," Ubicaci\xF3n "),n())}function fi(e,t){if(e&1&&(o(0,"td",19),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.ubicacionActual," ")}}function gi(e,t){e&1&&(o(0,"th",18),a(1," \xDAltima Act. "),n())}function Ci(e,t){if(e&1&&(o(0,"td",19),a(1),P(2,"date"),n()),e&2){let i=t.$implicit;l(),c(" ",A(2,1,i.fechaHoraActualizacion,"dd/MM HH:mm")," ")}}function hi(e,t){e&1&&(o(0,"th",18),a(1," Pr\xF3ximo Destino "),n())}function _i(e,t){if(e&1&&(o(0,"td",19),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.proximoDestino," ")}}function bi(e,t){e&1&&(o(0,"th",18),a(1," Estimado Llegada "),n())}function vi(e,t){if(e&1&&(o(0,"td",19),a(1),P(2,"date"),n()),e&2){let i=t.$implicit;l(),c(" ",A(2,1,i.estimadoLlegada,"dd/MM HH:mm")," ")}}function Di(e,t){e&1&&(o(0,"th",18),a(1," Lotes "),n())}function xi(e,t){if(e&1){let i=x();o(0,"td",19)(1,"button",20),h("click",function(){let s=v(i).$implicit,d=u();return D(d.onVerLotes(s.idSeguimiento))}),a(2," Ver Lotes "),n()()}}function Ei(e,t){e&1&&(o(0,"th",18),a(1," Info Veh\xEDculo "),n())}function Ii(e,t){if(e&1){let i=x();o(0,"td",19)(1,"button",21),h("click",function(){let s=v(i).$implicit,d=u();return D(d.onVerInfoVehiculo(s.idVehiculo))}),a(2," Info "),n()()}}function Ti(e,t){e&1&&(o(0,"th",18),a(1," Entrega "),n())}function Si(e,t){if(e&1){let i=x();o(0,"td",19)(1,"button",21),h("click",function(){let s=v(i).$implicit,d=u();return D(d.onConfirmarEntrega(s.idOrden))}),a(2," ConfirmarEntrega "),n()()}}function Mi(e,t){e&1&&(o(0,"th",18),a(1," Incidencia "),n())}function Oi(e,t){if(e&1){let i=x();o(0,"td",19)(1,"button",22),h("click",function(){let s=v(i).$implicit,d=u();return D(d.onRegistrarIncidencia(s))}),a(2," Registrar "),n()()}if(e&2){let i=t.$implicit;l(),m("disabled",i.estadoActual!=="En Ruta")}}function Li(e,t){e&1&&C(0,"tr",23)}function yi(e,t){e&1&&C(0,"tr",24)}var je=class e{seguimientos=[];displayedColumns=["id","idOrdenDistId","idVehiculo","estadoActual","ubicacionActual","fechaHoraActualizacion","proximoDestino","estimadoLlegada","verLotes","infoVehiculo","confirmarEntrega","registrarIncidencia"];verLotes=new w;verInfoVehiculo=new w;confirmarEntrega=new w;registrarIncidencia=new w;onVerLotes(t){this.verLotes.emit(t)}onVerInfoVehiculo(t){this.verInfoVehiculo.emit(t)}onConfirmarEntrega(t){this.confirmarEntrega.emit(t)}onRegistrarIncidencia(t){this.registrarIncidencia.emit(t)}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=b({type:e,selectors:[["app-monitoreo-vehiculos-table"]],inputs:{seguimientos:"seguimientos"},outputs:{verLotes:"verLotes",verInfoVehiculo:"verInfoVehiculo",confirmarEntrega:"confirmarEntrega",registrarIncidencia:"registrarIncidencia"},standalone:!1,decls:40,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","idSeguimiento"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","idOrden"],["matColumnDef","idVehiculo"],["matColumnDef","estadoActual"],["matColumnDef","ubicacionActual"],["matColumnDef","fechaHoraActualizacion"],["matColumnDef","proximoDestino"],["matColumnDef","estimadoLlegada"],["matColumnDef","verLotes"],["matColumnDef","infoVehiculo"],["matColumnDef","confirmarEntrega"],["matColumnDef","registrarIncidencia"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["color","primary",3,"click"],["color","default",3,"click"],["color","accent",3,"click","disabled"],["mat-header-row",""],["mat-row",""]],template:function(i,r){i&1&&(o(0,"div",0)(1,"table",1),f(2,2),p(3,ai,2,0,"th",3)(4,ri,2,1,"td",4),g(),f(5,5),p(6,li,2,0,"th",3)(7,ci,2,1,"td",4),g(),f(8,6),p(9,si,2,0,"th",3)(10,di,2,2,"td",4),g(),f(11,7),p(12,mi,2,0,"th",3)(13,pi,2,1,"td",4),g(),f(14,8),p(15,ui,2,0,"th",3)(16,fi,2,1,"td",4),g(),f(17,9),p(18,gi,2,0,"th",3)(19,Ci,3,4,"td",4),g(),f(20,10),p(21,hi,2,0,"th",3)(22,_i,2,1,"td",4),g(),f(23,11),p(24,bi,2,0,"th",3)(25,vi,3,4,"td",4),g(),f(26,12),p(27,Di,2,0,"th",3)(28,xi,3,0,"td",4),g(),f(29,13),p(30,Ei,2,0,"th",3)(31,Ii,3,0,"td",4),g(),f(32,14),p(33,Ti,2,0,"th",3)(34,Si,3,0,"td",4),g(),f(35,15),p(36,Mi,2,0,"th",3)(37,Oi,3,1,"td",4),g(),p(38,Li,1,0,"tr",16)(39,yi,1,0,"tr",17),n()()),i&2&&(l(),m("dataSource",r.seguimientos||y(3,oi)),l(37),m("matHeaderRowDef",r.displayedColumns),l(),m("matRowDefColumns",r.displayedColumns))},dependencies:[N,k,j,$,F,q,B,H,U,z,Z],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};var Ri=["class","component"];function wi(e,t){e&1&&(o(0,"div",4),C(1,"mat-progress-spinner",5),o(2,"p"),a(3,"Cargando veh\xEDculos en ruta..."),n()())}function Pi(e,t){if(e&1){let i=x();o(0,"app-monitoreo-vehiculos-table",8),h("verLotes",function(s){v(i);let d=u(2);return D(d.onVerLotes(s))})("verInfoVehiculo",function(s){v(i);let d=u(2);return D(d.onVerInfoVehiculo(s))})("confirmarEntrega",function(s){v(i);let d=u(2);return D(d.onConfirmarEntrega(s))})("registrarIncidencia",function(s){v(i);let d=u(2);return D(d.onRegistrarIncidencia(s))}),n()}if(e&2){let i=u(2);m("seguimientos",i.getSeguimientosFiltrados())}}function Ai(e,t){e&1&&(o(0,"div",7)(1,"h2"),a(2,"No hay Veh\xEDculos en Ruta"),n(),o(3,"p"),a(4,"Actualmente, no hay \xF3rdenes de distribuci\xF3n activas o en tr\xE1nsito."),n()())}function Ni(e,t){if(e&1&&M(0,Pi,1,1,"app-monitoreo-vehiculos-table",6)(1,Ai,5,0,"div",7),e&2){let i=u();O(i.getSeguimientosFiltrados()&&i.getSeguimientosFiltrados().length>0?0:1)}}var qe=class e{constructor(t,i,r){this.distribucionService=t;this.dialog=i;this.router=r}seguimientos=null;isLoading=!0;filtroBusqueda="";ngOnInit(){this.cargarSeguimientos()}cargarSeguimientos(){this.isLoading=!0,this.distribucionService.getSeguimientoVehiculos().pipe(E(()=>this.isLoading=!1)).subscribe({next:t=>{this.seguimientos=t},error:t=>{console.error("Error al cargar seguimientos:",t)}})}getSeguimientosFiltrados(){if(!this.seguimientos)return null;if(!this.filtroBusqueda)return this.seguimientos;let t=this.filtroBusqueda.toLowerCase();return this.seguimientos.filter(i=>i.id.toString().includes(t)||i.idVehiculo.placa.toLowerCase().includes(t)||i.proximoDestino.toLowerCase().includes(t))}onVerLotes(t){this.router.navigate(["/GestionDistribucion/vehiculos/lotes",t])}onVerInfoVehiculo(t){let i={idVehiculo:t};this.dialog.open(Fe,{width:"450px",data:i})}onConfirmarEntrega(t){let i={titulo:"Confirmar Entrega de Orden",mensaje:`\xBFDesea confirmar la entrega final de la Orden N\xB0 ${t}? Esta acci\xF3n no se puede deshacer y finalizar\xE1 el seguimiento.`,itemNombre:`Orden de Distribuci\xF3n #${t}`};this.dialog.open(ke,{width:"450px",data:i}).afterClosed().subscribe(s=>{s?.confirmado&&this.ejecutarConfirmacionEntrega(t)})}ejecutarConfirmacionEntrega(t){let i=this.seguimientos?.find(r=>r.idOrdenDistId===t);i&&this.distribucionService.confirmarEntrega(t).pipe(E(()=>this.isLoading=!1)).subscribe({next:()=>{alert(`Entrega de Orden #${t} confirmada con \xE9xito. El seguimiento ha finalizado.`),i.estadoActual="Entregada",this.seguimientos=this.seguimientos.filter(r=>r.idOrdenDistId!==t),this.seguimientos=[...this.seguimientos]},error:r=>{console.error("Error al confirmar entrega:",r),alert(`Error: No se pudo confirmar la entrega de la Orden #${t}.`)}})}onRegistrarIncidencia(t){let i=t.idOrdenDistId;this.isLoading=!0,this.distribucionService.getLotesBySeguimientoId(t.id).pipe(E(()=>this.isLoading=!1)).subscribe({next:r=>{let s=r.map(T=>T.idLote),d={idVehiculo:t.idVehiculo.id,idOrdenDist:i,idUsuarioReporta:1,idDetalleDist:null,lotesDisponibles:s};this.dialog.open(Be,{width:"600px",height:"800px",data:d}).afterClosed().subscribe(T=>{T?.success&&alert("Incidencia registrada con \xE9xito para la Orden "+i)})},error:r=>{console.error("Error al cargar lotes para incidencia:",r),alert("No se pudo cargar la lista de lotes disponibles para el reporte de incidencia.")}})}static \u0275fac=function(i){return new(i||e)(_(S),_(be),_(de))};static \u0275cmp=b({type:e,selectors:[["app-monitoreo-vehiculos-list",8,"component"]],standalone:!1,attrs:Ri,decls:12,vars:2,consts:[[1,"page-container"],[1,"card-section"],[1,"search-bar"],["type","text","placeholder","Buscar por Seg. N\xB0, Placa o Destino",3,"ngModelChange","ngModel"],[1,"loading-state","centered-content"],["mode","indeterminate","diameter","50"],[3,"seguimientos"],[1,"empty-state","centered-content"],[3,"verLotes","verInfoVehiculo","confirmarEntrega","registrarIncidencia","seguimientos"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"h2"),a(2,"Monitoreo de Veh\xEDculos en Ruta"),n(),o(3,"mat-card",1)(4,"h3"),a(5,"Seguimiento en tiempo real de las \xF3rdenes en tr\xE1nsito."),n(),o(6,"div",2)(7,"h3"),a(8,"Buscar Seguimiento"),n(),o(9,"input",3),se("ngModelChange",function(d){return ce(r.filtroBusqueda,d)||(r.filtroBusqueda=d),d}),n()(),M(10,wi,4,0,"div",4)(11,Ni,2,1),n()()),i&2&&(l(9),le("ngModel",r.filtroBusqueda),l(),O(r.isLoading?10:11))},dependencies:[ne,V,me,te,pe,je],encapsulation:2})};var Fi=()=>[];function ki(e,t){e&1&&(o(0,"th",11),a(1," Lote N\xB0 "),n())}function $i(e,t){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.idLote," ")}}function Bi(e,t){e&1&&(o(0,"th",11),a(1," Producto "),n())}function Hi(e,t){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let i=t.$implicit;l(),c(" **",i.nombreProducto,"** ")}}function ji(e,t){e&1&&(o(0,"th",11),a(1," Cantidad "),n())}function qi(e,t){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.cantidadProducto," ")}}function Ui(e,t){e&1&&(o(0,"th",11),a(1," Condici\xF3n Requerida "),n())}function zi(e,t){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.condicionTransporteRequerida," ")}}function Gi(e,t){e&1&&(o(0,"th",11),a(1," Asignar Veh\xEDculo "),n())}function Wi(e,t){if(e&1&&(o(0,"mat-option",15),a(1),n()),e&2){let i=t.$implicit,r=u(2);m("value",i.idVehiculo),l(),c(" ",r.getVehiculoLabel(i)," ")}}function Yi(e,t){e&1&&(o(0,"mat-option",18),a(1," No hay veh\xEDculos compatibles disponibles. "),n()),e&2&&m("disabled",!0)}function Zi(e,t){if(e&1){let i=x();o(0,"td",12)(1,"div",13)(2,"mat-select",14),se("ngModelChange",function(s){let d=v(i).$implicit;return ce(d.idVehiculoAsignado,s)||(d.idVehiculoAsignado=s),D(s)}),h("selectionChange",function(){let s=v(i).$implicit,d=u();return D(d.onVehiculoChange(s))}),o(3,"mat-option",15),a(4,"-- Sin Asignar --"),n(),p(5,Wi,2,2,"mat-option",16)(6,Yi,2,1,"mat-option",17),n()()()}if(e&2){let i=t.$implicit;l(2),le("ngModel",i.idVehiculoAsignado),l(),m("value",null),l(2),m("ngForOf",i.opcionesVehiculo),l(),m("ngIf",!(i.opcionesVehiculo!=null&&i.opcionesVehiculo.length))}}function Ji(e,t){e&1&&C(0,"tr",19)}function Xi(e,t){e&1&&C(0,"tr",20)}var Ge=class e{detalles=[];displayedColumns=["idLote","nombreProducto","cantidadProducto","condicionTransporte","asignacionVehiculo"];asignacionCambio=new w;onVehiculoChange(t){this.asignacionCambio.emit(t)}getVehiculoLabel(t){return`#${t.id} | ${t.placa} | ${t.tipoVehiculo||"N/A"}`}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=b({type:e,selectors:[["app-asignacion-lote-vehiculo-table"]],inputs:{detalles:"detalles"},outputs:{asignacionCambio:"asignacionCambio"},standalone:!1,decls:19,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","idLote"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombreProducto"],["matColumnDef","cantidadProducto"],["matColumnDef","condicionTransporte"],["matColumnDef","asignacionVehiculo"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["appearance","outline",1,"select-full-width"],[3,"ngModelChange","selectionChange","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[3,"disabled",4,"ngIf"],[3,"disabled"],["mat-header-row",""],["mat-row",""]],template:function(i,r){i&1&&(o(0,"div",0)(1,"table",1),f(2,2),p(3,ki,2,0,"th",3)(4,$i,2,1,"td",4),g(),f(5,5),p(6,Bi,2,0,"th",3)(7,Hi,2,1,"td",4),g(),f(8,6),p(9,ji,2,0,"th",3)(10,qi,2,1,"td",4),g(),f(11,7),p(12,Ui,2,0,"th",3)(13,zi,2,1,"td",4),g(),f(14,8),p(15,Gi,2,0,"th",3)(16,Zi,7,4,"td",4),g(),p(17,Ji,1,0,"tr",9)(18,Xi,1,0,"tr",10),n()()),i&2&&(l(),m("dataSource",r.detalles||y(3,Fi)),l(16),m("matHeaderRowDef",r.displayedColumns),l(),m("matRowDefColumns",r.displayedColumns))},dependencies:[Pe,ft,Y,N,k,j,$,F,q,B,H,U,z,te,pe,Ne],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};function Qi(e,t){e&1&&(o(0,"div",11),C(1,"mat-progress-spinner",12),o(2,"p"),a(3,"Cargando lotes y veh\xEDculos disponibles..."),n()())}function en(e,t){if(e&1){let i=x();o(0,"div")(1,"p",13),a(2," Seleccione el veh\xEDculo adecuado para cada lote. El veh\xEDculo debe cumplir con la **condici\xF3n de transporte requerida** (ej: Ambiente, Fr\xEDo). "),n(),o(3,"app-asignacion-lote-vehiculo-table",14),h("asignacionCambio",function(s){v(i);let d=u();return D(d.onAsignacionChange(s))}),n()()}if(e&2){let i=u();l(3),m("detalles",i.detallesOrden)}}function tn(e,t){e&1&&(o(0,"div",15)(1,"mat-icon"),a(2,"info"),n(),o(3,"p"),a(4,"Esta orden no tiene lotes pendientes de asignaci\xF3n de veh\xEDculo."),n()())}function nn(e,t){e&1&&(o(0,"span"),a(1,"Confirmar Asignaci\xF3n"),n())}var We=class e{constructor(t,i,r){this.dialogRef=t;this.data=i;this.distribucionService=r;this.idOrden=i.idOrden}idOrden;detallesOrden=null;isLoading=!0;isSaving=!1;get isOrderFullyAssigned(){return this.detallesOrden?this.detallesOrden.every(t=>t.idVehiculoAsignado!==null):!1}ngOnInit(){this.cargarDetallesOrden()}cargarDetallesOrden(){this.isLoading=!0,this.distribucionService.getDetallesOrdenParaAsignacion(this.idOrden).pipe(E(()=>this.isLoading=!1)).subscribe({next:t=>{this.detallesOrden=t},error:t=>{console.error("Error al cargar detalles de la orden:",t),alert("Error al cargar detalles de la orden de distribuci\xF3n.")}})}onAsignacionChange(t){console.log(`Lote ${t.idLote} asignado a veh\xEDculo: ${t.idVehiculoAsignado}`)}onConfirmarAsignacion(){if(!this.isOrderFullyAssigned){alert("Debe asignar un veh\xEDculo a todos los lotes antes de confirmar.");return}this.detallesOrden&&(this.isSaving=!0,this.distribucionService.guardarAsignacionVehiculos(this.idOrden,this.detallesOrden).pipe(E(()=>this.isSaving=!1)).subscribe({next:()=>{this.dialogRef.close({success:!0,detallesActualizados:this.detallesOrden})},error:t=>{console.error("Error al guardar asignaci\xF3n:",t),alert("Error al guardar la asignaci\xF3n. Intente de nuevo.")}}))}onCancelar(){this.dialogRef.close({success:!1})}static \u0275fac=function(i){return new(i||e)(_(K),_(Q),_(S))};static \u0275cmp=b({type:e,selectors:[["app-popup-lote-asignacion-vehiculo"]],standalone:!1,decls:14,vars:8,consts:[["color","primary"],[1,"dialog-title"],[1,"spacer"],[3,"click","disabled"],["mat-dialog-content","",1,"dialog-content"],["class","loading-state centered-content",4,"ngIf"],[4,"ngIf"],["class","empty-state centered-content",4,"ngIf"],["mat-dialog-actions","","align","end"],["type","button",3,"click","disabled"],["color","primary",3,"click","disabled"],[1,"loading-state","centered-content"],["mode","indeterminate","diameter","30"],[1,"text-sm","mb-4"],[3,"asignacionCambio","detalles"],[1,"empty-state","centered-content"]],template:function(i,r){i&1&&(o(0,"mat-toolbar",0)(1,"span",1),a(2),n(),C(3,"span",2),o(4,"button",3),h("click",function(){return r.onCancelar()}),n()(),o(5,"div",4),p(6,Qi,4,0,"div",5)(7,en,4,1,"div",6)(8,tn,5,0,"div",7),n(),o(9,"div",8)(10,"button",9),h("click",function(){return r.onCancelar()}),a(11," Cancelar "),n(),o(12,"button",10),h("click",function(){return r.onConfirmarAsignacion()}),p(13,nn,2,0,"span",6),n()()),i&2&&(l(2),c(" Asignar Veh\xEDculos a Orden N\xB0 ",r.idOrden," "),l(2),m("disabled",r.isSaving),l(2),m("ngIf",r.isLoading),l(),m("ngIf",!r.isLoading&&r.detallesOrden&&r.detallesOrden.length>0),l(),m("ngIf",!r.isLoading&&(!r.detallesOrden||r.detallesOrden.length===0)),l(2),m("disabled",r.isSaving),l(2),m("disabled",!r.isOrderFullyAssigned||r.isSaving),l(),m("ngIf",!r.isSaving))},dependencies:[ie,ee,J,ne,Y,Dt,Ge],encapsulation:2})};var Ye=class e{constructor(t,i){this.dialogRef=t;this.data=i}onConfirmar(){this.dialogRef.close({confirmado:!0})}onCancelar(){this.dialogRef.close({confirmado:!1})}static \u0275fac=function(i){return new(i||e)(_(K),_(Q))};static \u0275cmp=b({type:e,selectors:[["app-popup-cancelar-orden"]],standalone:!1,decls:21,vars:3,consts:[["color","warn"],[1,"dialog-title"],[1,"spacer"],[3,"click"],["mat-dialog-content","",1,"dialog-content"],[1,"message-area"],["mat-dialog-actions","","align","end"],["mat-button","","type","button","color","default",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(i,r){i&1&&(o(0,"mat-toolbar",0)(1,"span",1),a(2),n(),C(3,"span",2),o(4,"button",3),h("click",function(){return r.onCancelar()}),a(5," Cerrar "),n()(),o(6,"div",4)(7,"div",5)(8,"p"),a(9),n(),o(10,"p")(11,"strong"),a(12,"\xCDtem:"),n(),a(13),n(),o(14,"p"),a(15,"\xBFDesea continuar con esta acci\xF3n?"),n()()(),o(16,"div",6)(17,"button",7),h("click",function(){return r.onCancelar()}),a(18," Cancelar "),n(),o(19,"button",8),h("click",function(){return r.onConfirmar()}),a(20," Confirmar Entrega "),n()()),i&2&&(l(2),W(r.data.titulo),l(7),W(r.data.mensaje),l(4),c(" ",r.data.itemNombre))},dependencies:[ie,ee,J,X],encapsulation:2})};var on=()=>[];function an(e,t){e&1&&(o(0,"th",15),a(1," OC N\xB0 "),n())}function rn(e,t){if(e&1&&(o(0,"td",16),a(1),n()),e&2){let i=t.$implicit;l(),c(" **",i.idOrden,"** ")}}function ln(e,t){e&1&&(o(0,"th",15),a(1," Req. N\xB0 "),n())}function cn(e,t){if(e&1&&(o(0,"td",16),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.idRequerimiento," ")}}function sn(e,t){e&1&&(o(0,"th",15),a(1," Solicitante "),n())}function dn(e,t){if(e&1&&(o(0,"td",16),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.nombreUsuario," ")}}function mn(e,t){e&1&&(o(0,"th",15),a(1," \xC1rea "),n())}function pn(e,t){if(e&1&&(o(0,"td",16),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.area," ")}}function un(e,t){e&1&&(o(0,"th",15),a(1," Estado "),n())}function fn(e,t){if(e&1&&(o(0,"td",16),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.estado," ")}}function gn(e,t){e&1&&(o(0,"th",15),a(1," Prioridad "),n())}function Cn(e,t){if(e&1&&(o(0,"td",16),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.prioridad," ")}}function hn(e,t){e&1&&(o(0,"th",15),a(1," Entrega Est. "),n())}function _n(e,t){if(e&1&&(o(0,"td",16),a(1),P(2,"date"),n()),e&2){let i=t.$implicit;l(),c(" ",A(2,1,i.fechaEntregaEstimada,"dd/MM/yyyy")," ")}}function bn(e,t){e&1&&(o(0,"th",15),a(1," Designar Movilidad "),n())}function vn(e,t){if(e&1){let i=x();o(0,"td",16)(1,"button",17),h("click",function(){let s=v(i).$implicit,d=u();return D(d.onDesignarMovilidad(s.idOrden))}),a(2," Designar Movilidad "),n()()}if(e&2){let i=t.$implicit;l(),m("disabled",i.estado!=="Pendiente")}}function Dn(e,t){e&1&&(o(0,"th",15),a(1," Cancelar Orden "),n())}function xn(e,t){if(e&1){let i=x();o(0,"td",16)(1,"button",18),h("click",function(){let s=v(i).$implicit,d=u();return D(d.onCancelarOrden(s.idOrden))}),a(2," Cancelar Orden "),n()()}}function En(e,t){e&1&&C(0,"tr",19)}function In(e,t){e&1&&C(0,"tr",20)}var Ze=class e{ordenes=[];displayedColumns=["id","idRequerimiento","nombreUsuario","area","estado","prioridad","fechaEntregaEstimada","designarMovilidad","cancelarOrden"];designarMovilidad=new w;cancelarOrden=new w;onDesignarMovilidad(t){this.designarMovilidad.emit(t)}onCancelarOrden(t){this.cancelarOrden.emit(t)}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=b({type:e,selectors:[["app-ordenes-distribucion-table"]],inputs:{ordenes:"ordenes"},outputs:{designarMovilidad:"designarMovilidad",cancelarOrden:"cancelarOrden"},standalone:!1,decls:31,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","idOrden"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","idRequerimiento"],["matColumnDef","nombreUsuario"],["matColumnDef","area"],["matColumnDef","estado"],["matColumnDef","prioridad"],["matColumnDef","fechaEntregaEstimada"],["matColumnDef","designarMovilidad"],["matColumnDef","cancelarOrden"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["color","accent",3,"click","disabled"],["color","accent",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,r){i&1&&(o(0,"div",0)(1,"table",1),f(2,2),p(3,an,2,0,"th",3)(4,rn,2,1,"td",4),g(),f(5,5),p(6,ln,2,0,"th",3)(7,cn,2,1,"td",4),g(),f(8,6),p(9,sn,2,0,"th",3)(10,dn,2,1,"td",4),g(),f(11,7),p(12,mn,2,0,"th",3)(13,pn,2,1,"td",4),g(),f(14,8),p(15,un,2,0,"th",3)(16,fn,2,1,"td",4),g(),f(17,9),p(18,gn,2,0,"th",3)(19,Cn,2,1,"td",4),g(),f(20,10),p(21,hn,2,0,"th",3)(22,_n,3,4,"td",4),g(),f(23,11),p(24,bn,2,0,"th",3)(25,vn,3,1,"td",4),g(),f(26,12),p(27,Dn,2,0,"th",3)(28,xn,3,0,"td",4),g(),p(29,En,1,0,"tr",13)(30,In,1,0,"tr",14),n()()),i&2&&(l(),m("dataSource",r.ordenes||y(3,on)),l(28),m("matHeaderRowDef",r.displayedColumns),l(),m("matRowDefColumns",r.displayedColumns))},dependencies:[N,k,j,$,F,q,B,H,U,z,Z],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};var Sn=["class","component"];function Mn(e,t){if(e&1){let i=x();o(0,"app-ordenes-distribucion-table",6),h("designarMovilidad",function(s){v(i);let d=u();return D(d.onDesignarMovilidad(s))})("cancelarOrden",function(s){v(i);let d=u();return D(d.onCancelarOrden(s))}),n()}if(e&2){let i=u();m("ordenes",i.getOrdenesFiltradas())}}function On(e,t){e&1&&(o(0,"div",5)(1,"h2"),a(2,"No hay \xD3rdenes Pendientes"),n(),o(3,"p"),a(4,"No se encontraron \xF3rdenes de distribuci\xF3n que requieran asignaci\xF3n de veh\xEDculos."),n()())}var Se=class e{constructor(t,i){this.distribucionService=t;this.dialog=i}ordenes=null;isLoading=!0;filtroBusqueda="";ngOnInit(){this.cargarOrdenes()}cargarOrdenes(){this.isLoading=!0,this.distribucionService.getOrdenesDistribucion().pipe(E(()=>this.isLoading=!1)).subscribe({next:t=>{this.ordenes=t},error:t=>{console.error("Error al cargar \xF3rdenes de distribuci\xF3n:",t)}})}getOrdenesFiltradas(){if(!this.ordenes)return null;if(!this.filtroBusqueda)return this.ordenes;let t=this.filtroBusqueda.toLowerCase();return this.ordenes.filter(i=>i.id.toString().includes(t)||i.nombreUsuario&&i.nombreUsuario.toLowerCase().includes(t)||i.area&&i.area.toLowerCase().includes(t))}onDesignarMovilidad(t){let i={idOrden:t};this.dialog.open(We,{width:"900px",data:i}).afterClosed().subscribe(s=>{s?.success&&this.actualizarEstadoOrdenLocal(t,"Programada")})}actualizarEstadoOrdenLocal(t,i){if(!this.ordenes)return;let r=this.ordenes.findIndex(s=>s.id===t);r!==-1&&(this.ordenes[r]=xe(De({},this.ordenes[r]),{estado:i}),this.ordenes=[...this.ordenes])}onCancelarOrden(t){let i={titulo:"Confirmaci\xF3n de Cancelaci\xF3n",mensaje:`\xBFEst\xE1 seguro de CANCELAR la Orden de Distribuci\xF3n N\xB0 ${t}? Esto detendr\xE1 el proceso de entrega.`,itemNombre:`Orden N\xB0 ${t}`};this.dialog.open(Ye,{width:"450px",data:i}).afterClosed().subscribe(s=>{s?.confirmado&&this.ejecutarCancelacion(t)})}ejecutarCancelacion(t){this.distribucionService.cancelarOrden(t).pipe(E(()=>this.isLoading=!1)).subscribe({next:()=>{alert(`Orden N\xB0 ${t} cancelada con \xE9xito.`),this.actualizarEstadoOrdenLocal(t,"Cancelada")},error:i=>{console.error("Error al cancelar orden:",i),alert(`Error: No se pudo cancelar la Orden N\xB0 ${t}.`)}})}static \u0275fac=function(i){return new(i||e)(_(S),_(be))};static \u0275cmp=b({type:e,selectors:[["app-ordenes-distribucion-list",8,"component"]],standalone:!1,attrs:Sn,decls:12,vars:2,consts:[[1,"page-container"],[1,"card-section"],[1,"search-bar"],["type","text","placeholder","Buscar por N\xB0 de Orden, Solicitante o \xC1rea",3,"ngModelChange","ngModel"],[3,"ordenes"],[1,"empty-state","centered-content"],[3,"designarMovilidad","cancelarOrden","ordenes"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"h2"),a(2,"Lista de \xD3rdenes de Distribuci\xF3n"),n(),o(3,"mat-card",1)(4,"h3"),a(5,"\xD3rdenes pendientes y en proceso de distribuci\xF3n."),n(),o(6,"div",2)(7,"h3"),a(8,"Buscar Orden"),n(),o(9,"input",3),se("ngModelChange",function(d){return ce(r.filtroBusqueda,d)||(r.filtroBusqueda=d),d}),n()(),M(10,Mn,1,1,"app-ordenes-distribucion-table",4)(11,On,5,0,"div",5),n()()),i&2&&(l(9),le("ngModel",r.filtroBusqueda),l(),O(r.getOrdenesFiltradas()&&r.getOrdenesFiltradas().length>0?10:11))},dependencies:[V,me,te,pe,Ze],encapsulation:2})};function Ln(e,t){e&1&&(o(0,"div",8),C(1,"mat-progress-spinner",9),o(2,"p"),a(3,"Cargando datos del lote..."),n()())}function yn(e,t){if(e&1&&(o(0,"div")(1,"mat-card",10)(2,"p")(3,"strong"),a(4,"N\xB0 de Lote:"),n(),a(5),n(),o(6,"p")(7,"strong"),a(8,"ID Producto:"),n(),a(9),n(),o(10,"p")(11,"strong"),a(12,"Estado:"),n(),a(13),n(),C(14,"mat-divider"),o(15,"p")(16,"strong"),a(17,"Cantidad Inicial:"),n(),a(18),n(),o(19,"p")(20,"strong"),a(21,"Cantidad Actual:"),n(),a(22),n(),C(23,"mat-divider"),o(24,"p")(25,"strong"),a(26,"Fecha de Fabricaci\xF3n:"),n(),a(27),P(28,"date"),n(),o(29,"p")(30,"strong"),a(31,"Fecha de Vencimiento:"),n(),a(32),P(33,"date"),n()()()),e&2){let i=u();l(5),c(" ",i.lote.numeroLote),l(4),c(" ",i.lote.idProducto),l(4),c(" ",i.lote.estado),l(5),c(" ",i.lote.cantInicial),l(4),c(" ",i.lote.cantActual),l(5),c(" ",A(28,7,i.lote.fechaFabricacion,"dd/MM/yyyy")),l(5),c(" ",A(33,10,i.lote.fechaVencimiento,"dd/MM/yyyy"))}}function Vn(e,t){e&1&&(o(0,"div",11)(1,"p"),a(2,"No se encontraron detalles para el lote especificado."),n()())}var Je=class e{constructor(t,i,r){this.dialogRef=t;this.data=i;this.distribucionService=r}lote=null;isLoading=!0;ngOnInit(){this.cargarInfoLote(this.data.idLote)}cargarInfoLote(t){this.isLoading=!0,this.distribucionService.getInfoLote(t).pipe(E(()=>this.isLoading=!1)).subscribe({next:i=>{this.lote=i},error:i=>{console.error("Error al cargar informaci\xF3n del lote:",i),alert("Error al cargar la informaci\xF3n del lote.")}})}onClose(){this.dialogRef.close()}static \u0275fac=function(i){return new(i||e)(_(K),_(Q),_(S))};static \u0275cmp=b({type:e,selectors:[["app-popup-info-lote"]],standalone:!1,decls:10,vars:4,consts:[["color","accent"],[1,"dialog-title"],[1,"spacer"],["mat-button","",3,"click"],["mat-dialog-content","",1,"dialog-content"],["class","loading-state centered-content",4,"ngIf"],[4,"ngIf"],["class","empty-state centered-content",4,"ngIf"],[1,"loading-state","centered-content"],["mode","indeterminate","diameter","30"],[1,"info-card"],[1,"empty-state","centered-content"]],template:function(i,r){i&1&&(o(0,"mat-toolbar",0)(1,"span",1),a(2),n(),C(3,"span",2),o(4,"button",3),h("click",function(){return r.onClose()}),a(5," Cerrar "),n()(),o(6,"div",4),p(7,Ln,4,0,"div",5)(8,yn,34,13,"div",6)(9,Vn,3,0,"div",7),n()),i&2&&(l(2),c(" Informaci\xF3n Detallada del Lote N\xB0 ",r.data.idLote," "),l(5),m("ngIf",r.isLoading),l(),m("ngIf",!r.isLoading&&r.lote),l(),m("ngIf",!r.isLoading&&!r.lote))},dependencies:[ee,J,ne,Y,X,V,we,Z],encapsulation:2})};var Rn=()=>[];function wn(e,t){e&1&&(o(0,"th",10),a(1," Lote N\xB0 "),n())}function Pn(e,t){if(e&1&&(o(0,"td",11),a(1),n()),e&2){let i=t.$implicit;l(),c(" **",i.idLote,"** ")}}function An(e,t){e&1&&(o(0,"th",10),a(1," Producto "),n())}function Nn(e,t){if(e&1&&(o(0,"td",11),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.nombreProducto," ")}}function Fn(e,t){e&1&&(o(0,"th",10),a(1," Cantidad "),n())}function kn(e,t){if(e&1&&(o(0,"td",11),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.cantidadTransportada," ")}}function $n(e,t){e&1&&(o(0,"th",10),a(1," Acci\xF3n "),n())}function Bn(e,t){if(e&1){let i=x();o(0,"td",11)(1,"button",12),h("click",function(){let s=v(i).$implicit,d=u();return D(d.onVerInfoLote(s.idLote))}),a(2," Ver Info Lote "),n()()}}function Hn(e,t){e&1&&C(0,"tr",13)}function jn(e,t){e&1&&C(0,"tr",14)}var Xe=class e{detalles=[];displayedColumns=["idLote","nombreProducto","cantidadTransportada","accion"];verInfoLote=new w;onVerInfoLote(t){this.verInfoLote.emit(t)}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=b({type:e,selectors:[["app-vehiculo-lotes-table"]],inputs:{detalles:"detalles"},outputs:{verInfoLote:"verInfoLote"},standalone:!1,decls:16,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","idLote"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombreProducto"],["matColumnDef","cantidadTransportada"],["matColumnDef","accion"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-button","","color","accent",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,r){i&1&&(o(0,"div",0)(1,"table",1),f(2,2),p(3,wn,2,0,"th",3)(4,Pn,2,1,"td",4),g(),f(5,5),p(6,An,2,0,"th",3)(7,Nn,2,1,"td",4),g(),f(8,6),p(9,Fn,2,0,"th",3)(10,kn,2,1,"td",4),g(),f(11,7),p(12,$n,2,0,"th",3)(13,Bn,3,0,"td",4),g(),p(14,Hn,1,0,"tr",8)(15,jn,1,0,"tr",9),n()()),i&2&&(l(),m("dataSource",r.detalles||y(3,Rn)),l(13),m("matHeaderRowDef",r.displayedColumns),l(),m("matRowDefColumns",r.displayedColumns))},dependencies:[N,k,j,$,F,q,B,H,U,z,X],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};var Un=["class","component"],zn=()=>["/GestionDistribucion/monitoreo"];function Gn(e,t){e&1&&(o(0,"div",3),C(1,"mat-progress-spinner",6),o(2,"p"),a(3,"Cargando lotes..."),n()())}function Wn(e,t){if(e&1){let i=x();o(0,"app-vehiculo-lotes-table",9),h("verInfoLote",function(s){v(i);let d=u(2);return D(d.onVerInfoLote(s))}),n()}if(e&2){let i=u(2);m("detalles",i.detallesTransporte)}}function Yn(e,t){e&1&&(o(0,"div",8)(1,"h2"),a(2,"No hay Lotes Asignados"),n(),o(3,"p"),a(4,"Este seguimiento no tiene lotes registrados para el transporte."),n()())}function Zn(e,t){if(e&1&&M(0,Wn,1,1,"app-vehiculo-lotes-table",7)(1,Yn,5,0,"div",8),e&2){let i=u();O(i.detallesTransporte&&i.detallesTransporte.length>0?0:1)}}var Ke=class e{constructor(t,i,r){this.distribucionService=t;this.dialog=i;this.route=r}idSeguimiento=0;detallesTransporte=null;isLoading=!0;infoSeguimiento={placa:"[Cargando...]",destino:"[Cargando...]"};ngOnInit(){this.route.paramMap.subscribe(t=>{let i=t.get("idSeguimiento");i?(this.idSeguimiento=+i,this.cargarDetallesLotes(this.idSeguimiento),this.infoSeguimiento={placa:"ABC-123",destino:"Hospital Central"}):(console.error("ID de seguimiento no encontrado."),this.isLoading=!1)})}cargarDetallesLotes(t){this.isLoading=!0,this.distribucionService.getLotesBySeguimientoId(t).pipe(E(()=>this.isLoading=!1)).subscribe({next:i=>{this.detallesTransporte=i},error:i=>{console.error("Error al cargar lotes del seguimiento:",i),alert("Error al cargar la lista de lotes.")}})}onVerInfoLote(t){let i={idLote:t};this.dialog.open(Je,{width:"500px",data:i})}static \u0275fac=function(i){return new(i||e)(_(S),_(be),_(_e))};static \u0275cmp=b({type:e,selectors:[["app-vehiculo-lotes-list",8,"component"]],standalone:!1,attrs:Un,decls:22,vars:6,consts:[[1,"page-container"],[1,"card-section","header-details"],[1,"card-section","table-container"],[1,"loading-state","centered-content"],[1,"footer-actions"],["mat-button","",3,"routerLink"],["mode","indeterminate","diameter","50"],[3,"detalles"],[1,"empty-state","centered-content"],[3,"verInfoLote","detalles"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"h2"),a(2),n(),o(3,"mat-card",1)(4,"h3"),a(5,"Detalles del Transporte"),n(),o(6,"p")(7,"strong"),a(8,"Veh\xEDculo:"),n(),a(9),n(),o(10,"p")(11,"strong"),a(12,"Pr\xF3ximo Destino:"),n(),a(13),n()(),o(14,"mat-card",2)(15,"h3"),a(16,"Lotes Transportados"),n(),M(17,Gn,4,0,"div",3)(18,Zn,2,1),n(),o(19,"div",4)(20,"button",5),a(21," Volver a Monitoreo de Veh\xEDculos "),n()()()),i&2&&(l(2),c("Lotes en Tr\xE1nsito (Seguimiento N\xB0 ",r.idSeguimiento,")"),l(7),c(" ",r.infoSeguimiento.placa),l(4),c(" ",r.infoSeguimiento.destino),l(4),O(r.isLoading?17:18),l(3),m("routerLink",y(5,zn)))},dependencies:[ne,ht,X,V,Xe],encapsulation:2})};var Jn=()=>[];function Xn(e,t){e&1&&(o(0,"th",13),a(1," Fecha Reporte "),n())}function Kn(e,t){if(e&1&&(o(0,"td",14),a(1),P(2,"date"),n()),e&2){let i=t.$implicit;l(),c(" ",A(2,1,i.fechaReporte,"dd/MM/yyyy HH:mm")," ")}}function Qn(e,t){e&1&&(o(0,"th",13),a(1," Tipo "),n())}function eo(e,t){if(e&1&&(o(0,"td",14),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.tipoIncidencia," ")}}function to(e,t){e&1&&(o(0,"th",13),a(1," Impacto "),n())}function io(e,t){if(e&1&&(o(0,"td",14)(1,"span",15),a(2),n()()),e&2){let i=t.$implicit,r=u();l(),m("ngClass",r.getImpactoClass(i.impacto)),l(),c(" ",i.impacto," ")}}function no(e,t){e&1&&(o(0,"th",13),a(1," Lote Afectado "),n())}function oo(e,t){e&1&&(o(0,"span",17),a(1,"(Veh\xEDculo/Orden)"),n())}function ao(e,t){if(e&1&&(o(0,"td",14),a(1),p(2,oo,2,0,"span",16),n()),e&2){let i=t.$implicit;l(),c(" ",i.idDetalleDist||"General"," "),l(),m("ngIf",!i.idDetalleDist)}}function ro(e,t){e&1&&(o(0,"th",13),a(1," Descripci\xF3n "),n())}function lo(e,t){if(e&1&&(o(0,"td",14),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.descripcion," ")}}function co(e,t){e&1&&(o(0,"th",13),a(1," Reportado por "),n())}function so(e,t){if(e&1&&(o(0,"td",14),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.usuarioReporta," ")}}function mo(e,t){e&1&&C(0,"tr",18)}function po(e,t){e&1&&C(0,"tr",19)}function uo(e,t){if(e&1&&(o(0,"tr",20)(1,"td",21),a(2," No se han registrado incidencias para esta Orden. "),n()()),e&2){let i=u();l(),mt("colspan",i.displayedColumns.length)}}var Qe=class e{incidencias=[];displayedColumns=["fechaReporte","tipoIncidencia","impacto","idLoteAfectado","descripcion","usuarioReporta"];getImpactoClass(t){switch(t){case"Alto":return"impacto-alto";case"Moderado":return"impacto-moderado";case"Bajo":default:return"impacto-bajo"}}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=b({type:e,selectors:[["app-reporte-incidencias-table"]],inputs:{incidencias:"incidencias"},standalone:!1,decls:23,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","fechaReporte"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","tipoIncidencia"],["matColumnDef","impacto"],["matColumnDef","idLoteAfectado"],["matColumnDef","descripcion"],["matColumnDef","usuarioReporta"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell",""],["mat-cell",""],[3,"ngClass"],["class","text-xs text-gray-500",4,"ngIf"],[1,"text-xs","text-gray-500"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"table",1),f(2,2),p(3,Xn,2,0,"th",3)(4,Kn,3,4,"td",4),g(),f(5,5),p(6,Qn,2,0,"th",3)(7,eo,2,1,"td",4),g(),f(8,6),p(9,to,2,0,"th",3)(10,io,3,2,"td",4),g(),f(11,7),p(12,no,2,0,"th",3)(13,ao,3,2,"td",4),g(),f(14,8),p(15,ro,2,0,"th",3)(16,lo,2,1,"td",4),g(),f(17,9),p(18,co,2,0,"th",3)(19,so,2,1,"td",4),g(),p(20,mo,1,0,"tr",10)(21,po,1,0,"tr",11)(22,uo,3,1,"tr",12),n()()),i&2&&(l(),m("dataSource",r.incidencias||y(3,Jn)),l(19),m("matHeaderRowDef",r.displayedColumns),l(),m("matRowDefColumns",r.displayedColumns))},dependencies:[ut,Y,N,k,j,$,F,q,B,H,U,z,Vt,Z],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};var go=["class","component"];function Co(e,t){if(e&1&&C(0,"app-reporte-incidencias-table",3),e&2){let i=u();m("incidencias",i.incidencias)}}function ho(e,t){if(e&1&&(o(0,"div",4)(1,"h3",5),a(2,"Sin Incidencias Registradas"),n(),o(3,"p"),a(4),n()()),e&2){let i=u();l(4),c("La Orden N\xB0 ",i.idOrden," fue entregada sin ning\xFAn reporte de novedad o problema.")}}var et=class e{constructor(t,i,r){this.route=t;this.router=i;this.distribucionService=r}idOrden=null;incidencias=null;isLoading=!0;errorCarga=null;ngOnInit(){this.route.paramMap.pipe(Ce(t=>{let i=t.get("idOrden");return i?(this.idOrden=+i,this.distribucionService.getIncidenciasByOrdenId(this.idOrden)):(this.errorCarga="ID de Orden no proporcionado en la URL.",oe(null))}),E(()=>this.isLoading=!1)).subscribe({next:t=>{t&&(this.incidencias=t)},error:t=>{this.errorCarga="Ocurri\xF3 un error al intentar cargar las incidencias desde el servidor.",this.incidencias=[]}})}goBack(){this.router.navigate(["/GestionDistribucion/reportes/entregas"])}static \u0275fac=function(i){return new(i||e)(_(_e),_(de),_(S))};static \u0275cmp=b({type:e,selectors:[["app-incidencias-reporte",8,"component"]],standalone:!1,attrs:go,decls:8,vars:2,consts:[[1,"page-container"],["color","primary",1,"back-button",3,"click"],[1,"card-section"],[3,"incidencias"],[1,"empty-state","centered-content"],[1,"mt-2"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"button",1),h("click",function(){return r.goBack()}),a(2," Volver a Reportes de Entrega "),n(),o(3,"h2"),a(4),n(),o(5,"mat-card",2),M(6,Co,1,1,"app-reporte-incidencias-table",3)(7,ho,5,1,"div",4),n()()),i&2&&(l(4),c("Incidencias Reportadas para Orden de Distribuci\xF3n N\xB0 **",r.idOrden,"**"),l(2),O(r.incidencias&&r.incidencias.length>0?6:7))},dependencies:[V,Qe],encapsulation:2})};var _o=()=>[];function bo(e,t){e&1&&(o(0,"th",11),a(1," Lote N\xB0 "),n())}function vo(e,t){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let i=t.$implicit;l(),c(" **",i.idLote,"** ")}}function Do(e,t){e&1&&(o(0,"th",11),a(1," Producto "),n())}function xo(e,t){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.nombreProducto," ")}}function Eo(e,t){e&1&&(o(0,"th",11),a(1," Cantidad "),n())}function Io(e,t){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.cantidadProducto," ")}}function To(e,t){e&1&&(o(0,"th",11),a(1," Condici\xF3n Req. "),n())}function So(e,t){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.condicionTransporteRequerida," ")}}function Mo(e,t){e&1&&(o(0,"th",11),a(1," Veh\xEDculo Asignado "),n())}function Oo(e,t){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let i=t.$implicit;l(),c(" #",i.idVehiculoAsignado," ")}}function Lo(e,t){e&1&&C(0,"tr",13)}function yo(e,t){e&1&&C(0,"tr",14)}var tt=class e{detalles=[];displayedColumns=["idLote","nombreProducto","cantidadProducto","condicionTransporteRequerida","idVehiculoAsignado"];static \u0275fac=function(i){return new(i||e)};static \u0275cmp=b({type:e,selectors:[["app-reporte-detalle-lotes-table"]],inputs:{detalles:"detalles"},standalone:!1,decls:19,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","idLote"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombreProducto"],["matColumnDef","cantidadProducto"],["matColumnDef","condicionTransporteRequerida"],["matColumnDef","idVehiculoAsignado"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(i,r){i&1&&(o(0,"div",0)(1,"table",1),f(2,2),p(3,bo,2,0,"th",3)(4,vo,2,1,"td",4),g(),f(5,5),p(6,Do,2,0,"th",3)(7,xo,2,1,"td",4),g(),f(8,6),p(9,Eo,2,0,"th",3)(10,Io,2,1,"td",4),g(),f(11,7),p(12,To,2,0,"th",3)(13,So,2,1,"td",4),g(),f(14,8),p(15,Mo,2,0,"th",3)(16,Oo,2,1,"td",4),g(),p(17,Lo,1,0,"tr",9)(18,yo,1,0,"tr",10),n()()),i&2&&(l(),m("dataSource",r.detalles||y(3,_o)),l(16),m("matHeaderRowDef",r.displayedColumns),l(),m("matRowDefColumns",r.displayedColumns))},dependencies:[N,k,j,$,F,q,B,H,U,z],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};var Ro=["class","component"];function wo(e,t){if(e&1&&(o(0,"div",2)(1,"h3"),a(2,"Error de Carga"),n(),o(3,"p"),a(4),n()()),e&2){let i=u();l(4),W(i.errorCarga)}}function Po(e,t){if(e&1&&(o(0,"div",3)(1,"mat-card",5)(2,"h3"),a(3,"Resumen de la Orden"),n(),o(4,"p")(5,"strong"),a(6,"Solicitante:"),n(),a(7),n(),o(8,"p")(9,"strong"),a(10,"\xC1rea Destino:"),n(),a(11),n(),o(12,"p")(13,"strong"),a(14,"Fecha Entrega:"),n(),a(15),P(16,"date"),n(),o(17,"p")(18,"strong"),a(19,"Estado Final:"),n(),o(20,"span",6),a(21),n()()(),o(22,"mat-card",5)(23,"h3"),a(24,"Detalles de Transporte"),n(),o(25,"p")(26,"strong"),a(27,"Veh\xEDculo ID:"),n(),a(28),n(),o(29,"p")(30,"strong"),a(31,"Destino Final:"),n(),a(32),n(),o(33,"p")(34,"strong"),a(35,"Ubicaci\xF3n Cierre:"),n(),a(36),n(),o(37,"p")(38,"strong"),a(39,"Fecha Cierre:"),n(),a(40),P(41,"date"),n()(),o(42,"mat-card",7)(43,"h3"),a(44),n(),C(45,"app-reporte-detalle-lotes-table",8),n(),o(46,"mat-card",9)(47,"h3"),a(48,"Notas y Justificaci\xF3n de Cierre"),n(),o(49,"p",10),a(50),n()()()),e&2){let i=u();l(7),c(" ",i.detalleCompleto.orden.nombreUsuario),l(4),c(" ",i.detalleCompleto.orden.area),l(4),c(" ",A(16,12,i.detalleCompleto.orden.fechaEntregaEstimada,"dd/MM/yyyy")),l(6),W(i.detalleCompleto.orden.estado),l(7),he(" #",i.detalleCompleto.infoSeguimiento.idVehiculo," (",i.detalleCompleto.infoSeguimiento.placaVehiculo,")"),l(4),c(" ",i.detalleCompleto.infoSeguimiento.proximoDestino),l(4),c(" ",i.detalleCompleto.infoSeguimiento.ubicacionActual),l(4),c(" ",A(41,15,i.detalleCompleto.infoSeguimiento.fechaHoraActualizacion,"dd/MM/yyyy HH:mm")),l(4),c("Lotes Transportados (",i.detalleCompleto.detallesLotes.length," \xEDtems)"),l(),m("detalles",i.detalleCompleto.detallesLotes),l(5),W(i.detalleCompleto.justificacionCierre||"No se registraron notas de cierre para esta entrega.")}}function Ao(e,t){if(e&1&&(o(0,"div",4)(1,"h3",11),a(2,"Reporte no Disponible"),n(),o(3,"p"),a(4),n()()),e&2){let i=u();l(4),c("No se encontraron datos completos para la Orden N\xB0 ",i.idOrden,".")}}var it=class e{constructor(t,i,r){this.route=t;this.router=i;this.distribucionService=r}idOrden=null;detalleCompleto=null;isLoading=!0;errorCarga=null;ngOnInit(){this.route.paramMap.pipe(Ce(t=>{let i=t.get("idOrden");return i?(this.idOrden=+i,this.distribucionService.getDetalleReporteOrden(this.idOrden)):(this.errorCarga="ID de Orden no proporcionado.",oe(null))}),E(()=>this.isLoading=!1)).subscribe({next:t=>{t&&(this.detalleCompleto=t)},error:t=>{console.error("Error al cargar detalle de reporte:",t),this.errorCarga="Ocurri\xF3 un error al intentar cargar el reporte completo."}})}goBack(){this.router.navigate(["/GestionDistribucion/reportes"])}static \u0275fac=function(i){return new(i||e)(_(_e),_(de),_(S))};static \u0275cmp=b({type:e,selectors:[["app-detalles-reporte",8,"component"]],standalone:!1,attrs:Ro,decls:8,vars:2,consts:[[1,"page-container"],["color","primary",1,"back-button",3,"click"],[1,"error-state","centered-content"],[1,"report-content-grid"],[1,"empty-state","centered-content"],[1,"card-section","info-card"],[1,"font-bold","text-green-600"],[1,"card-section","table-card","full-width"],[3,"detalles"],[1,"card-section","full-width"],[1,"text-gray-700","whitespace-pre-wrap"],[1,"mt-2"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"button",1),h("click",function(){return r.goBack()}),a(2," Volver a Reportes de Entrega "),n(),o(3,"h2"),a(4),n(),M(5,wo,5,1,"div",2)(6,Po,51,18,"div",3)(7,Ao,5,1,"div",4),n()),i&2&&(l(4),c("Detalle Completo de Orden N\xB0 **",r.idOrden,"**"),l(),O(r.errorCarga?5:r.detalleCompleto?6:7))},dependencies:[V,tt,Z],encapsulation:2})};var No=()=>[];function Fo(e,t){e&1&&(o(0,"th",14),a(1," OC N\xB0 "),n())}function ko(e,t){if(e&1&&(o(0,"td",15),a(1),n()),e&2){let i=t.$implicit;l(),c(" **",i.idOrden,"** ")}}function $o(e,t){e&1&&(o(0,"th",14),a(1," Req. N\xB0 "),n())}function Bo(e,t){if(e&1&&(o(0,"td",15),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.idRequerimiento," ")}}function Ho(e,t){e&1&&(o(0,"th",14),a(1," Solicitante "),n())}function jo(e,t){if(e&1&&(o(0,"td",15),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.nombreUsuario," ")}}function qo(e,t){e&1&&(o(0,"th",14),a(1," \xC1rea "),n())}function Uo(e,t){if(e&1&&(o(0,"td",15),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.area," ")}}function zo(e,t){e&1&&(o(0,"th",14),a(1," Fecha Entrega "),n())}function Go(e,t){if(e&1&&(o(0,"td",15),a(1),P(2,"date"),n()),e&2){let i=t.$implicit;l(),c(" ",A(2,1,i.fechaEntregaEstimada,"dd/MM/yyyy")," ")}}function Wo(e,t){e&1&&(o(0,"th",14),a(1," Lotes "),n())}function Yo(e,t){if(e&1&&(o(0,"td",15),a(1),n()),e&2){let i=t.$implicit;l(),c(" ",i.totalLotes," ")}}function Zo(e,t){e&1&&(o(0,"th",14),a(1," Detalles "),n())}function Jo(e,t){if(e&1){let i=x();o(0,"td",15)(1,"button",16),h("click",function(){let s=v(i).$implicit,d=u();return D(d.onVerDetalles(s.idOrden))}),a(2," Ver Detalle "),n()()}}function Xo(e,t){e&1&&(o(0,"th",14),a(1," Incidencias "),n())}function Ko(e,t){if(e&1){let i=x();o(0,"td",15)(1,"button",17),h("click",function(){let s=v(i).$implicit,d=u();return D(d.onVerIncidencias(s.idOrden))}),a(2),n()()}if(e&2){let i=t.$implicit;l(),m("disabled",!i.tieneIncidencias),l(),c(" ",i.tieneIncidencias?"Ver":"N/A"," ")}}function Qo(e,t){e&1&&C(0,"tr",18)}function ea(e,t){e&1&&C(0,"tr",19)}var nt=class e{ordenes=[];displayedColumns=["idOrden","idRequerimiento","nombreUsuario","area","fechaEntregaEstimada","totalLotes","accionDetalle","accionIncidencia"];verDetalles=new w;verIncidencias=new w;onVerDetalles(t){this.verDetalles.emit(t)}onVerIncidencias(t){this.verIncidencias.emit(t)}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=b({type:e,selectors:[["app-reporte-ordenes-table"]],inputs:{ordenes:"ordenes"},outputs:{verDetalles:"verDetalles",verIncidencias:"verIncidencias"},standalone:!1,decls:28,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","idOrden"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","idRequerimiento"],["matColumnDef","nombreUsuario"],["matColumnDef","area"],["matColumnDef","fechaEntregaEstimada"],["matColumnDef","totalLotes"],["matColumnDef","accionDetalle"],["matColumnDef","accionIncidencia"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["color","primary",3,"click"],["color","warn",3,"click","disabled"],["mat-header-row",""],["mat-row",""]],template:function(i,r){i&1&&(o(0,"div",0)(1,"table",1),f(2,2),p(3,Fo,2,0,"th",3)(4,ko,2,1,"td",4),g(),f(5,5),p(6,$o,2,0,"th",3)(7,Bo,2,1,"td",4),g(),f(8,6),p(9,Ho,2,0,"th",3)(10,jo,2,1,"td",4),g(),f(11,7),p(12,qo,2,0,"th",3)(13,Uo,2,1,"td",4),g(),f(14,8),p(15,zo,2,0,"th",3)(16,Go,3,4,"td",4),g(),f(17,9),p(18,Wo,2,0,"th",3)(19,Yo,2,1,"td",4),g(),f(20,10),p(21,Zo,2,0,"th",3)(22,Jo,3,0,"td",4),g(),f(23,11),p(24,Xo,2,0,"th",3)(25,Ko,3,2,"td",4),g(),p(26,Qo,1,0,"tr",12)(27,ea,1,0,"tr",13),n()()),i&2&&(l(),m("dataSource",r.ordenes||y(3,No)),l(25),m("matHeaderRowDef",r.displayedColumns),l(),m("matRowDefColumns",r.displayedColumns))},dependencies:[N,k,j,$,F,q,B,H,U,z,Z],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};var ia=["class","component"];function na(e,t){e&1&&(o(0,"div",4),C(1,"mat-progress-spinner",5),o(2,"p"),a(3,"Cargando \xF3rdenes entregadas..."),n()())}function oa(e,t){if(e&1){let i=x();o(0,"app-reporte-ordenes-table",8),h("verDetalles",function(s){v(i);let d=u(2);return D(d.onVerDetalles(s))})("verIncidencias",function(s){v(i);let d=u(2);return D(d.onVerIncidencias(s))}),n()}if(e&2){let i=u(2);m("ordenes",i.getOrdenesFiltradas())}}function aa(e,t){e&1&&(o(0,"div",7)(1,"h2"),a(2,"No hay \xD3rdenes Entregadas"),n(),o(3,"p"),a(4,"Ninguna orden ha sido marcada como 'Completada' en el sistema."),n()())}function ra(e,t){if(e&1&&M(0,oa,1,1,"app-reporte-ordenes-table",6)(1,aa,5,0,"div",7),e&2){let i=u();O(i.getOrdenesFiltradas()&&i.getOrdenesFiltradas().length>0?0:1)}}var ot=class e{constructor(t,i){this.distribucionService=t;this.router=i}ordenesEntregadas=null;isLoading=!0;filtroBusqueda="";ngOnInit(){this.cargarReporteOrdenes()}cargarReporteOrdenes(){this.isLoading=!0,this.distribucionService.getReporteOrdenesEntregadas().pipe(E(()=>this.isLoading=!1)).subscribe({next:t=>{this.ordenesEntregadas=t},error:t=>{console.error("Error al cargar reporte de \xF3rdenes:",t)}})}getOrdenesFiltradas(){if(!this.ordenesEntregadas)return null;if(!this.filtroBusqueda)return this.ordenesEntregadas;let t=this.filtroBusqueda.toLowerCase();return this.ordenesEntregadas.filter(i=>i.id.toString().includes(t)||i.nombreUsuario&&i.nombreUsuario.toLowerCase().includes(t)||i.area&&i.area.toLowerCase().includes(t))}onVerDetalles(t){this.router.navigate(["/GestionDistribucion/reportes/detalles",t])}onVerIncidencias(t){this.router.navigate(["/GestionDistribucion/reportes/incidencias",t])}static \u0275fac=function(i){return new(i||e)(_(S),_(de))};static \u0275cmp=b({type:e,selectors:[["app-reportes-entrega-list",8,"component"]],standalone:!1,attrs:ia,decls:13,vars:2,consts:[[1,"page-container"],[1,"card-section"],[1,"search-bar"],["type","text","placeholder","Buscar por N\xB0 de Orden, Solicitante o \xC1rea",3,"ngModelChange","ngModel"],[1,"loading-state","centered-content"],["mode","indeterminate","diameter","50"],[3,"ordenes"],[1,"empty-state","centered-content"],[3,"verDetalles","verIncidencias","ordenes"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"h2"),a(2,"Reporte de \xD3rdenes de Distribuci\xF3n Entregadas"),n(),o(3,"mat-card",1)(4,"h3"),a(5,"\xD3rdenes cuyo estado es 'Completada' y requieren revisi\xF3n de incidencias."),n(),o(6,"div",2)(7,"h3"),a(8,"Buscar Orden Entregada"),n(),o(9,"input",3),se("ngModelChange",function(d){return ce(r.filtroBusqueda,d)||(r.filtroBusqueda=d),d}),n()()(),o(10,"mat-card"),M(11,na,4,0,"div",4)(12,ra,2,1),n()()),i&2&&(l(9),le("ngModel",r.filtroBusqueda),l(2),O(r.isLoading?11:12))},dependencies:[ne,V,me,te,pe,nt],encapsulation:2})};var la=[{path:"",component:Se},{path:"asignacion",component:Se},{path:"monitoreo",component:qe},{path:"reportes",component:ot},{path:"vehiculos/lotes/:idSeguimiento",component:Ke},{path:"reportes/incidencias/:idOrden",component:et},{path:"reportes/detalles/:idOrden",component:it}],at=class e{static \u0275fac=function(i){return new(i||e)};static \u0275mod=Le({type:e});static \u0275inj=Oe({imports:[rt.forChild(la),rt]})};var Ht=class e{static \u0275fac=function(i){return new(i||e)};static \u0275mod=Le({type:e});static \u0275inj=Oe({imports:[$t,Ft,_t,Bt,at,Ae,gt,Rt,vt,Pt,xt,Et,Nt,Lt,yt,Ae,At]})};export{Ht as DistribucionModule};

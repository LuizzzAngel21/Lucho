import{a as we,b as Pe,c as Ae,d as At}from"./chunk-IAWJUBHW.js";import{a as J,b as X,c as Ce,d as K,e as ee,f as Ft,g as kt,h as Bt,i as te,j as $t}from"./chunk-DXCHC2D2.js";import{a as Y,b as ht}from"./chunk-4DUNT3H5.js";import"./chunk-A3ALBLIS.js";import"./chunk-GMITE7GY.js";import"./chunk-JINNKTRQ.js";import{p as Nt}from"./chunk-JXCPYOSY.js";import{$ as b,$b as Z,Ac as Ot,B as dt,Bc as Lt,Cc as yt,Dc as P,E as D,Ec as A,F as v,Fa as pt,Fc as N,Ha as a,Hc as F,Ia as U,Ic as k,Ja as c,Ka as fe,Kc as B,La as ae,Lc as $,Ma as re,Na as le,Nc as H,Oc as j,Qc as q,R as l,Ra as L,Rc as Vt,S as V,Sc as Rt,Ta as R,Tc as ct,Ua as w,Vc as wt,Y as h,Zb as bt,a as be,aa as Oe,b as De,bb as ut,bc as Dt,cb as ft,cc as vt,db as G,dc as xt,ea as m,ec as Re,ed as y,f as z,fb as W,fc as Et,fd as Pt,g as Te,ga as mt,h as oe,ha as S,hb as gt,ia as M,j as rt,ja as Le,jc as se,ka as ye,kb as Ct,la as Ve,lc as pe,ma as d,mb as ge,na as o,nc as Q,oa as n,ob as ce,oc as Tt,pa as C,pb as _t,qa as f,qb as lt,qc as de,r as E,ra as g,rc as It,t as Ie,ta as x,tc as St,uc as Mt,va as _,wa as u,y as Se,z as Me}from"./chunk-26SCTFAY.js";var I=class e{constructor(i){this.http=i}apiUrl=`${ct.apiUrl}/api/distribucion`;getOrdenesDistribucion(){return this.http.get(`${this.apiUrl}/ordenes`).pipe(oe(i=>i.data.map(t=>({id:t.id,fechaDistribucion:t.fechaDistribucion,idRequerimiento:t.idRequerimiento,estado:t.estado,prioridad:t.prioridad}))))}getDetallesOrdenParaAsignacion(i){return rt({detalles:this.http.get(`${this.apiUrl}/ordenes/${i}/detalles`),vehiculos:this.http.get(`${this.apiUrl}/vehiculos/disponibles`)}).pipe(oe(({detalles:t,vehiculos:r})=>{let s=r.data.map(p=>({id:p.id,placa:p.placa,marca:p.marca,modelo:p.modelo,tipoVehiculo:p.tipoVehiculo,estado:p.estado,disponible:!0}));return t.data.map(p=>({idLote:p.idLote.id,nombreProducto:p.idProducto.nombreProducto,cantidadProducto:p.cantidad,condicionTransporteRequerida:"Ambiente",idVehiculoAsignado:null,opcionesVehiculo:s}))}))}guardarAsignacionVehiculos(i,t){let r=new Map;t.forEach(p=>{p.idVehiculoAsignado&&(r.has(p.idVehiculoAsignado)||r.set(p.idVehiculoAsignado,[]),r.get(p.idVehiculoAsignado)?.push(p))});let s=[];return r.forEach((p,at)=>{let he={idVehiculo:at,idOrdenDist:i,ubicacionActual:"Almac\xE9n Central",proximoDestino:"Destino Final",estimadoLlegada:new Date().toISOString(),idUsuarioActualizacion:1,detallesTransporte:p.map(st=>({idLote:st.idLote,cantidad:st.cantidadProducto}))};s.push(this.http.post(`${this.apiUrl}/seguimientos`,he))}),s.length===0?z(void 0):rt(s).pipe(oe(()=>{}))}getSeguimientoVehiculos(){return this.http.get(`${this.apiUrl}/vehiculos/en-camino`).pipe(oe(i=>i.data.map(t=>({id:t.id,idVehiculo:t.idVehiculo,idOrdenDistId:t.idOrdenDistId,estadoActual:t.estadoActual,ubicacionActual:t.ubicacionActual,fechaHoraActualizacion:t.fechaHoraActualizacion,proximoDestino:t.proximoDestino}))))}getLotesBySeguimientoId(i){return this.http.get(`${this.apiUrl}/seguimientos/${i}/lotes`).pipe(oe(t=>t.data.map(r=>({idLote:r.idLote.id,nombreProducto:r.idLote.numeroLote,cantidadTransportada:r.cantidad,incidenciaReportada:!1}))))}getInfoLote(i){return this.http.get(`${ct.apiUrl}/api/almacenamiento/lotes/${i}`).pipe(oe(t=>{let r=t.data;return{idLote:r.id,idProducto:r.idProducto.id,numeroLote:r.numeroLote,cantInicial:r.cantidadInicial,cantActual:r.cantidadActual,fechaFabricacion:r.fechaFabricacion,fechaVencimiento:r.fechaVencimiento,estado:r.estado}}))}getInfoVehiculo(i){return Te(()=>new Error(`Endpoint para veh\xEDculo ${i} no implementado.`))}confirmarEntrega(i){return z(void 0)}cancelarOrden(i){return z(void 0)}getDetalleReporteOrden(i){return z({})}getIncidenciasByOrdenId(i){return z([])}getReporteOrdenesEntregadas(){return this.getOrdenesDistribucion().pipe(oe(i=>i.filter(t=>t.estado==="Entregada").map(t=>De(be({},t),{totalLotes:0,tieneIncidencias:!1}))))}static \u0275fac=function(t){return new(t||e)(dt(Ct))};static \u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"})};function qt(e,i){if(e&1&&(o(0,"div")(1,"mat-card",9)(2,"h3"),a(3,"Informaci\xF3n Principal"),n(),o(4,"p")(5,"strong"),a(6,"ID:"),n(),a(7),n(),o(8,"p")(9,"strong"),a(10,"Placa:"),n(),a(11),n(),o(12,"p")(13,"strong"),a(14,"Disponibilidad:"),n(),o(15,"span"),a(16),n()(),C(17,"mat-divider",10),o(18,"h3"),a(19,"Detalles T\xE9cnicos"),n(),o(20,"p")(21,"strong"),a(22,"Tipo:"),n(),a(23),n(),o(24,"p")(25,"strong"),a(26,"Capacidad:"),n(),a(27),n(),o(28,"p")(29,"strong"),a(30,"Condici\xF3n de Transporte:"),n(),a(31),n()()()),e&2){let t=u();l(7),c(" #",t.vehiculo.id),l(4),c(" ",t.vehiculo.placa),l(4),pt("text-green-600",t.vehiculo.disponible)("text-red-600",!t.vehiculo.disponible),l(),c(" ",t.vehiculo.disponible?"DISPONIBLE":"EN USO / NO DISPONIBLE"," "),l(7),c(" ",t.vehiculo.tipoVehiculo),l(4),c(" ",t.vehiculo.capacidad," Toneladas/M\xB3"),l(4),c(" ",t.vehiculo.condicionTransporte)}}function Ut(e,i){e&1&&(o(0,"div",11)(1,"p"),a(2,"No se encontraron detalles para el veh\xEDculo especificado."),n()())}var Ne=class e{constructor(i,t,r){this.dialogRef=i;this.data=t;this.distribucionService=r}vehiculo=null;isLoading=!0;ngOnInit(){this.cargarInfoVehiculo(this.data.idVehiculo)}cargarInfoVehiculo(i){this.isLoading=!0,this.distribucionService.getInfoVehiculo(i).pipe(E(()=>this.isLoading=!1)).subscribe({next:t=>{this.vehiculo=t},error:t=>{console.error("Error al cargar informaci\xF3n del veh\xEDculo:",t),alert("Error al cargar la informaci\xF3n del veh\xEDculo.")}})}onClose(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||e)(h(J),h(X),h(I))};static \u0275cmp=b({type:e,selectors:[["app-popup-info-vehiculo"]],standalone:!1,decls:12,vars:3,consts:[["color","primary"],[1,"dialog-title"],[1,"spacer"],["mat-icon-button","",3,"click"],["mat-dialog-content","",1,"dialog-content"],[4,"ngIf"],["class","empty-state centered-content",4,"ngIf"],["mat-dialog-actions","","align","end"],["mat-raised-button","","color","primary",3,"click"],[1,"info-card"],[1,"my-3"],[1,"empty-state","centered-content"]],template:function(t,r){t&1&&(o(0,"mat-toolbar",0)(1,"span",1),a(2),n(),C(3,"span",2),o(4,"button",3),_("click",function(){return r.onClose()}),a(5," Cerrar "),n()(),o(6,"div",4),m(7,qt,32,10,"div",5)(8,Ut,3,0,"div",6),n(),o(9,"div",7)(10,"button",8),_("click",function(){return r.onClose()}),a(11,"Cerrar"),n()()),t&2&&(l(2),c(" Detalles del Veh\xEDculo N\xB0 ",r.data.idVehiculo," "),l(5),d("ngIf",!r.isLoading&&r.vehiculo),l(),d("ngIf",!r.isLoading&&!r.vehiculo))},dependencies:[ee,K,Y,G,Z,bt,y,Re],encapsulation:2})};var Fe=class e{constructor(i,t){this.dialogRef=i;this.data=t}onConfirmar(){this.dialogRef.close({confirmado:!0})}onCancelar(){this.dialogRef.close({confirmado:!1})}static \u0275fac=function(t){return new(t||e)(h(J),h(X))};static \u0275cmp=b({type:e,selectors:[["app-popup-confirmacion-entrega"]],standalone:!1,decls:21,vars:3,consts:[["color","warn"],[1,"dialog-title"],[1,"spacer"],[3,"click"],["mat-dialog-content","",1,"dialog-content"],[1,"message-area"],["mat-dialog-actions","","align","end"],["mat-button","","type","button","color","default",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,r){t&1&&(o(0,"mat-toolbar",0)(1,"span",1),a(2),n(),C(3,"span",2),o(4,"button",3),_("click",function(){return r.onCancelar()}),a(5," Cerrar "),n()(),o(6,"div",4)(7,"div",5)(8,"p"),a(9),n(),o(10,"p")(11,"strong"),a(12,"\xCDtem:"),n(),a(13),n(),o(14,"p"),a(15,"\xBFDesea continuar con esta acci\xF3n?"),n()()(),o(16,"div",6)(17,"button",7),_("click",function(){return r.onCancelar()}),a(18," Cancelar "),n(),o(19,"button",8),_("click",function(){return r.onConfirmar()}),a(20," Confirmar Entrega "),n()()),t&2&&(l(2),U(r.data.titulo),l(7),U(r.data.mensaje),l(4),c(" ",r.data.itemNombre))},dependencies:[ee,K,Y,Z],encapsulation:2})};var ke=class e{crearIncidencia(i){return console.log("[IncidenciaService] Registrando nueva incidencia:",i),i.descripcion.length<5?Te(()=>new Error("La descripci\xF3n debe ser m\xE1s detallada.")):z({success:!0})}static \u0275fac=function(t){return new(t||e)};static \u0275prov=Se({token:e,factory:e.\u0275fac,providedIn:"root"})};function Wt(e,i){if(e&1&&(o(0,"mat-option",10),a(1),n()),e&2){let t=u(2);d("value",t.f.idDetalleDist.value),l(),c(" LOTE PRESELECCIONADO: #",t.f.idDetalleDist.value," ")}}function Yt(e,i){if(e&1&&(o(0,"mat-option",10),a(1),n()),e&2){let t=i.$implicit;d("value",t),l(),c("LOTE: #",t)}}function Zt(e,i){e&1&&(o(0,"mat-option",18),a(1,"No hay lotes en esta orden."),n()),e&2&&d("disabled",!0)}function Jt(e,i){if(e&1&&(ye(0,Yt,2,2,"mat-option",10,Le),S(2,Zt,2,1,"mat-option",18)),e&2){let t=u(2);Ve(t.lotesDisponibles),l(2),M(t.lotesDisponibles.length===0?2:-1)}}function Xt(e,i){e&1&&(o(0,"mat-error"),a(1,"Debe seleccionar un lote afectado."),n())}function Kt(e,i){if(e&1&&(o(0,"div",7)(1,"h4"),a(2,"Lote Afectado *"),n(),o(3,"mat-select",17),S(4,Wt,2,2,"mat-option",10)(5,Jt,3,1),n(),m(6,Xt,2,0,"mat-error",11),n()),e&2){let t=u();l(3),d("disabled",t.f.idDetalleDist.disabled),l(),M(t.f.idDetalleDist.disabled?4:5),l(2),d("ngIf",t.f.idDetalleDist.hasError("required"))}}function Qt(e,i){if(e&1&&(o(0,"mat-option",10),a(1),n()),e&2){let t=i.$implicit;d("value",t),l(),U(t)}}function ei(e,i){e&1&&(o(0,"mat-error"),a(1,"El tipo es obligatorio."),n())}function ti(e,i){if(e&1&&(o(0,"mat-option",10),a(1),n()),e&2){let t=i.$implicit;d("value",t),l(),U(t)}}function ii(e,i){e&1&&(o(0,"mat-error"),a(1,"El impacto es obligatorio."),n())}function ni(e,i){e&1&&(o(0,"mat-error"),a(1,"La descripci\xF3n es obligatoria."),n())}var Be=class e{constructor(i,t,r,s){this.dialogRef=i;this.data=t;this.fb=r;this.incidenciaService=s}incidenciaForm;isLoading=!1;tiposIncidencia=["Accidente","Tr\xE1fico","Aver\xEDa Mec\xE1nica","Retraso Log\xEDstico","Problema de Carga/Descarga"];nivelesImpacto=["Bajo","Moderado","Alto"];lotesDisponibles=[];ngOnInit(){this.lotesDisponibles=this.data.lotesDisponibles||[],this.initForm(),this.incidenciaForm.get("problemaConLote")?.valueChanges.subscribe(i=>{this.toggleLoteField(i)})}toggleLoteField(i){let t=this.incidenciaForm.get("idDetalleDist");i?t?.setValidators([pe.required]):(t?.clearValidators(),t?.setValue(null)),t?.updateValueAndValidity()}initForm(){let i=this.data.idDetalleDist?[pe.required]:[],t=!!this.data.idDetalleDist;this.incidenciaForm=this.fb.group({idVehiculo:[{value:this.data.idVehiculo,disabled:!0}],idOrdenDist:[{value:this.data.idOrdenDist,disabled:!0}],problemaConLote:[t],idDetalleDist:[{value:this.data.idDetalleDist,disabled:!0},i],tipoIncidencia:["",pe.required],descripcion:["",[pe.required,pe.maxLength(500)]],impacto:["",pe.required]})}onSubmit(){if(this.incidenciaForm.updateValueAndValidity(),this.incidenciaForm.invalid){this.incidenciaForm.markAllAsTouched();return}let i=this.incidenciaForm.getRawValue(),t=i.problemaConLote?i.idDetalleDist:null,r={idVehiculo:i.idVehiculo,idOrdenDist:i.idOrdenDist,idUsuarioReporta:this.data.idUsuarioReporta,tipoIncidencia:i.tipoIncidencia,descripcion:i.descripcion,impacto:i.impacto,idDetalleDist:t};this.isLoading=!0,this.incidenciaService.crearIncidencia(r).pipe(E(()=>this.isLoading=!1)).subscribe({next:()=>{this.dialogRef.close({success:!0})},error:s=>{console.error("Error al registrar incidencia:",s),alert(`Error al registrar la incidencia: ${s.message||"Error de conexi\xF3n"}`)}})}onCancel(){this.dialogRef.close({success:!1})}get f(){return this.incidenciaForm.controls}static \u0275fac=function(t){return new(t||e)(h(J),h(X),h(Ot),h(ke))};static \u0275cmp=b({type:e,selectors:[["app-popup-crear-incidencia"]],standalone:!1,decls:39,vars:10,consts:[["color","warn"],[1,"dialog-title"],[1,"spacer"],[3,"click","disabled"],[1,"dialog-form",3,"ngSubmit","formGroup"],["mat-dialog-content","",1,"form-content"],[1,"mb-4","font-semibold","text-lg","border-b","pb-2"],[1,"form-field-group","full-width"],["formControlName","problemaConLote","color","warn",1,"status-checkbox"],["formControlName","tipoIncidencia"],[3,"value"],[4,"ngIf"],["formControlName","impacto"],["formControlName","descripcion","type","text"],["mat-dialog-actions","","align","end"],["type","button",3,"click","disabled"],["color","warn","type","submit",3,"disabled"],["formControlName","idDetalleDist",3,"disabled"],[3,"disabled"]],template:function(t,r){t&1&&(o(0,"mat-toolbar",0)(1,"span",1),a(2," Registrar Incidencia de Transporte "),n(),C(3,"span",2),o(4,"button",3),_("click",function(){return r.onCancel()}),a(5," Cerrar "),n()(),o(6,"form",4),_("ngSubmit",function(){return r.onSubmit()}),o(7,"div",5)(8,"h4",6),a(9),n(),o(10,"div",7)(11,"mat-checkbox",8),a(12," \xBFLa incidencia est\xE1 asociada a un Lote espec\xEDfico? "),n()(),S(13,Kt,7,3,"div",7),o(14,"div",7)(15,"h4"),a(16,"Tipo de Incidencia *"),n(),o(17,"div")(18,"mat-select",9),ye(19,Qt,2,2,"mat-option",10,Le),n(),m(21,ei,2,0,"mat-error",11),n()(),o(22,"div",7)(23,"h4"),a(24,"Nivel de Impacto *"),n(),o(25,"mat-select",12),ye(26,ti,2,2,"mat-option",10,Le),n(),m(28,ii,2,0,"mat-error",11),n(),o(29,"div",7)(30,"h4"),a(31,"Descripci\xF3n del Problema *"),n(),C(32,"input",13),m(33,ni,2,0,"mat-error",11),n()(),o(34,"div",14)(35,"button",15),_("click",function(){return r.onCancel()}),a(36," Cancelar "),n(),o(37,"button",16),a(38," Registrar "),n()()()),t&2&&(l(4),d("disabled",r.isLoading),l(2),d("formGroup",r.incidenciaForm),l(3),fe("Orden #",r.data.idOrdenDist," | Veh\xEDculo #",r.data.idVehiculo),l(4),M(r.f.problemaConLote.value?13:-1),l(6),Ve(r.tiposIncidencia),l(2),d("ngIf",r.f.tipoIncidencia.hasError("required")),l(5),Ve(r.nivelesImpacto),l(2),d("ngIf",r.f.impacto.hasError("required")),l(5),d("ngIf",r.f.descripcion.hasError("required")),l(2),d("disabled",r.isLoading),l(2),d("disabled",r.incidenciaForm.invalid||r.isLoading))},dependencies:[kt,ee,K,Y,we,G,It,se,Q,Tt,St,Mt,wt,Ae],encapsulation:2})};var oi=()=>[];function ai(e,i){e&1&&(o(0,"th",18),a(1," Seg. N\xB0 "),n())}function ri(e,i){if(e&1&&(o(0,"td",19),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.idSeguimiento," ")}}function li(e,i){e&1&&(o(0,"th",18),a(1," Orden N\xB0 "),n())}function ci(e,i){if(e&1&&(o(0,"td",19),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.idOrden," ")}}function si(e,i){e&1&&(o(0,"th",18),a(1," Veh\xEDculo "),n())}function di(e,i){if(e&1&&(o(0,"td",19),a(1),n()),e&2){let t=i.$implicit;l(),fe(" **#",t.idVehiculo," (",t.placaVehiculo,")** ")}}function mi(e,i){e&1&&(o(0,"th",18),a(1," Estado Actual "),n())}function pi(e,i){if(e&1&&(o(0,"td",19),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.estadoActual," ")}}function ui(e,i){e&1&&(o(0,"th",18),a(1," Ubicaci\xF3n "),n())}function fi(e,i){if(e&1&&(o(0,"td",19),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.ubicacionActual," ")}}function gi(e,i){e&1&&(o(0,"th",18),a(1," \xDAltima Act. "),n())}function Ci(e,i){if(e&1&&(o(0,"td",19),a(1),R(2,"date"),n()),e&2){let t=i.$implicit;l(),c(" ",w(2,1,t.fechaHoraActualizacion,"dd/MM HH:mm")," ")}}function _i(e,i){e&1&&(o(0,"th",18),a(1," Pr\xF3ximo Destino "),n())}function hi(e,i){if(e&1&&(o(0,"td",19),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.proximoDestino," ")}}function bi(e,i){e&1&&(o(0,"th",18),a(1," Estimado Llegada "),n())}function Di(e,i){if(e&1&&(o(0,"td",19),a(1),R(2,"date"),n()),e&2){let t=i.$implicit;l(),c(" ",w(2,1,t.estimadoLlegada,"dd/MM HH:mm")," ")}}function vi(e,i){e&1&&(o(0,"th",18),a(1," Lotes "),n())}function xi(e,i){if(e&1){let t=x();o(0,"td",19)(1,"button",20),_("click",function(){let s=D(t).$implicit,p=u();return v(p.onVerLotes(s.idSeguimiento))}),a(2," Ver Lotes "),n()()}}function Ei(e,i){e&1&&(o(0,"th",18),a(1," Info Veh\xEDculo "),n())}function Ti(e,i){if(e&1){let t=x();o(0,"td",19)(1,"button",21),_("click",function(){let s=D(t).$implicit,p=u();return v(p.onVerInfoVehiculo(s.idVehiculo))}),a(2," Info "),n()()}}function Ii(e,i){e&1&&(o(0,"th",18),a(1," Entrega "),n())}function Si(e,i){if(e&1){let t=x();o(0,"td",19)(1,"button",21),_("click",function(){let s=D(t).$implicit,p=u();return v(p.onConfirmarEntrega(s.idOrden))}),a(2," ConfirmarEntrega "),n()()}}function Mi(e,i){e&1&&(o(0,"th",18),a(1," Incidencia "),n())}function Oi(e,i){if(e&1){let t=x();o(0,"td",19)(1,"button",22),_("click",function(){let s=D(t).$implicit,p=u();return v(p.onRegistrarIncidencia(s))}),a(2," Registrar "),n()()}if(e&2){let t=i.$implicit;l(),d("disabled",t.estadoActual!=="En Ruta")}}function Li(e,i){e&1&&C(0,"tr",23)}function yi(e,i){e&1&&C(0,"tr",24)}var He=class e{seguimientos=[];displayedColumns=["id","idOrdenDistId","idVehiculo","estadoActual","ubicacionActual","fechaHoraActualizacion","proximoDestino","estimadoLlegada","verLotes","infoVehiculo","confirmarEntrega","registrarIncidencia"];verLotes=new V;verInfoVehiculo=new V;confirmarEntrega=new V;registrarIncidencia=new V;onVerLotes(i){this.verLotes.emit(i)}onVerInfoVehiculo(i){this.verInfoVehiculo.emit(i)}onConfirmarEntrega(i){this.confirmarEntrega.emit(i)}onRegistrarIncidencia(i){this.registrarIncidencia.emit(i)}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=b({type:e,selectors:[["app-monitoreo-vehiculos-table"]],inputs:{seguimientos:"seguimientos"},outputs:{verLotes:"verLotes",verInfoVehiculo:"verInfoVehiculo",confirmarEntrega:"confirmarEntrega",registrarIncidencia:"registrarIncidencia"},standalone:!1,decls:40,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","idSeguimiento"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","idOrden"],["matColumnDef","idVehiculo"],["matColumnDef","estadoActual"],["matColumnDef","ubicacionActual"],["matColumnDef","fechaHoraActualizacion"],["matColumnDef","proximoDestino"],["matColumnDef","estimadoLlegada"],["matColumnDef","verLotes"],["matColumnDef","infoVehiculo"],["matColumnDef","confirmarEntrega"],["matColumnDef","registrarIncidencia"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["color","primary",3,"click"],["color","default",3,"click"],["color","accent",3,"click","disabled"],["mat-header-row",""],["mat-row",""]],template:function(t,r){t&1&&(o(0,"div",0)(1,"table",1),f(2,2),m(3,ai,2,0,"th",3)(4,ri,2,1,"td",4),g(),f(5,5),m(6,li,2,0,"th",3)(7,ci,2,1,"td",4),g(),f(8,6),m(9,si,2,0,"th",3)(10,di,2,2,"td",4),g(),f(11,7),m(12,mi,2,0,"th",3)(13,pi,2,1,"td",4),g(),f(14,8),m(15,ui,2,0,"th",3)(16,fi,2,1,"td",4),g(),f(17,9),m(18,gi,2,0,"th",3)(19,Ci,3,4,"td",4),g(),f(20,10),m(21,_i,2,0,"th",3)(22,hi,2,1,"td",4),g(),f(23,11),m(24,bi,2,0,"th",3)(25,Di,3,4,"td",4),g(),f(26,12),m(27,vi,2,0,"th",3)(28,xi,3,0,"td",4),g(),f(29,13),m(30,Ei,2,0,"th",3)(31,Ti,3,0,"td",4),g(),f(32,14),m(33,Ii,2,0,"th",3)(34,Si,3,0,"td",4),g(),f(35,15),m(36,Mi,2,0,"th",3)(37,Oi,3,1,"td",4),g(),m(38,Li,1,0,"tr",16)(39,yi,1,0,"tr",17),n()()),t&2&&(l(),d("dataSource",r.seguimientos||L(3,oi)),l(37),d("matHeaderRowDef",r.displayedColumns),l(),d("matRowDefColumns",r.displayedColumns))},dependencies:[P,N,$,F,A,H,k,B,j,q,W],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};var Ri=["class","component"];function wi(e,i){e&1&&(o(0,"div",4),C(1,"mat-progress-spinner",5),o(2,"p"),a(3,"Cargando veh\xEDculos en ruta..."),n()())}function Pi(e,i){if(e&1){let t=x();o(0,"app-monitoreo-vehiculos-table",8),_("verLotes",function(s){D(t);let p=u(2);return v(p.onVerLotes(s))})("verInfoVehiculo",function(s){D(t);let p=u(2);return v(p.onVerInfoVehiculo(s))})("confirmarEntrega",function(s){D(t);let p=u(2);return v(p.onConfirmarEntrega(s))})("registrarIncidencia",function(s){D(t);let p=u(2);return v(p.onRegistrarIncidencia(s))}),n()}if(e&2){let t=u(2);d("seguimientos",t.getSeguimientosFiltrados())}}function Ai(e,i){e&1&&(o(0,"div",7)(1,"h2"),a(2,"No hay Veh\xEDculos en Ruta"),n(),o(3,"p"),a(4,"Actualmente, no hay \xF3rdenes de distribuci\xF3n activas o en tr\xE1nsito."),n()())}function Ni(e,i){if(e&1&&S(0,Pi,1,1,"app-monitoreo-vehiculos-table",6)(1,Ai,5,0,"div",7),e&2){let t=u();M(t.getSeguimientosFiltrados()&&t.getSeguimientosFiltrados().length>0?0:1)}}var je=class e{constructor(i,t,r){this.distribucionService=i;this.dialog=t;this.router=r}seguimientos=null;isLoading=!0;filtroBusqueda="";ngOnInit(){this.cargarSeguimientos()}cargarSeguimientos(){this.isLoading=!0,this.distribucionService.getSeguimientoVehiculos().pipe(E(()=>this.isLoading=!1)).subscribe({next:i=>{this.seguimientos=i},error:i=>{console.error("Error al cargar seguimientos:",i)}})}getSeguimientosFiltrados(){if(!this.seguimientos)return null;if(!this.filtroBusqueda)return this.seguimientos;let i=this.filtroBusqueda.toLowerCase();return this.seguimientos.filter(t=>t.id.toString().includes(i)||t.idVehiculo.placa.toLowerCase().includes(i)||t.proximoDestino.toLowerCase().includes(i))}onVerLotes(i){this.router.navigate(["/GestionDistribucion/vehiculos/lotes",i])}onVerInfoVehiculo(i){let t={idVehiculo:i};this.dialog.open(Ne,{width:"450px",data:t})}onConfirmarEntrega(i){let t={titulo:"Confirmar Entrega de Orden",mensaje:`\xBFDesea confirmar la entrega final de la Orden N\xB0 ${i}? Esta acci\xF3n no se puede deshacer y finalizar\xE1 el seguimiento.`,itemNombre:`Orden de Distribuci\xF3n #${i}`};this.dialog.open(Fe,{width:"450px",data:t}).afterClosed().subscribe(s=>{s?.confirmado&&this.ejecutarConfirmacionEntrega(i)})}ejecutarConfirmacionEntrega(i){let t=this.seguimientos?.find(r=>r.idOrdenDistId===i);t&&this.distribucionService.confirmarEntrega(i).pipe(E(()=>this.isLoading=!1)).subscribe({next:()=>{alert(`Entrega de Orden #${i} confirmada con \xE9xito. El seguimiento ha finalizado.`),t.estadoActual="Entregada",this.seguimientos=this.seguimientos.filter(r=>r.idOrdenDistId!==i),this.seguimientos=[...this.seguimientos]},error:r=>{console.error("Error al confirmar entrega:",r),alert(`Error: No se pudo confirmar la entrega de la Orden #${i}.`)}})}onRegistrarIncidencia(i){let t=i.idOrdenDistId;this.isLoading=!0,this.distribucionService.getLotesBySeguimientoId(i.id).pipe(E(()=>this.isLoading=!1)).subscribe({next:r=>{let s=r.map(he=>he.idLote),p={idVehiculo:i.idVehiculo.id,idOrdenDist:t,idUsuarioReporta:1,idDetalleDist:null,lotesDisponibles:s};this.dialog.open(Be,{width:"600px",height:"800px",data:p}).afterClosed().subscribe(he=>{he?.success&&alert("Incidencia registrada con \xE9xito para la Orden "+t)})},error:r=>{console.error("Error al cargar lotes para incidencia:",r),alert("No se pudo cargar la lista de lotes disponibles para el reporte de incidencia.")}})}static \u0275fac=function(t){return new(t||e)(h(I),h(Ce),h(ce))};static \u0275cmp=b({type:e,selectors:[["app-monitoreo-vehiculos-list",8,"component"]],standalone:!1,attrs:Ri,decls:12,vars:2,consts:[[1,"page-container"],[1,"card-section"],[1,"search-bar"],["type","text","placeholder","Buscar por Seg. N\xB0, Placa o Destino",3,"ngModelChange","ngModel"],[1,"loading-state","centered-content"],["mode","indeterminate","diameter","50"],[3,"seguimientos"],[1,"empty-state","centered-content"],[3,"verLotes","verInfoVehiculo","confirmarEntrega","registrarIncidencia","seguimientos"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"h2"),a(2,"Monitoreo de Veh\xEDculos en Ruta"),n(),o(3,"mat-card",1)(4,"h3"),a(5,"Seguimiento en tiempo real de las \xF3rdenes en tr\xE1nsito."),n(),o(6,"div",2)(7,"h3"),a(8,"Buscar Seguimiento"),n(),o(9,"input",3),le("ngModelChange",function(p){return re(r.filtroBusqueda,p)||(r.filtroBusqueda=p),p}),n()(),S(10,wi,4,0,"div",4)(11,Ni,2,1),n()()),t&2&&(l(9),ae("ngModel",r.filtroBusqueda),l(),M(r.isLoading?10:11))},dependencies:[te,y,se,Q,de,He],encapsulation:2})};var Fi=()=>[];function ki(e,i){e&1&&(o(0,"th",11),a(1," Lote N\xB0 "),n())}function Bi(e,i){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.idLote," ")}}function $i(e,i){e&1&&(o(0,"th",11),a(1," Producto "),n())}function Hi(e,i){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let t=i.$implicit;l(),c(" **",t.nombreProducto,"** ")}}function ji(e,i){e&1&&(o(0,"th",11),a(1," Cantidad "),n())}function qi(e,i){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.cantidadProducto," ")}}function Ui(e,i){e&1&&(o(0,"th",11),a(1," Condici\xF3n Requerida "),n())}function zi(e,i){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.condicionTransporteRequerida," ")}}function Gi(e,i){e&1&&(o(0,"th",11),a(1," Asignar Veh\xEDculo "),n())}function Wi(e,i){if(e&1&&(o(0,"mat-option",15),a(1),n()),e&2){let t=i.$implicit,r=u(2);d("value",t.idVehiculo),l(),c(" ",r.getVehiculoLabel(t)," ")}}function Yi(e,i){e&1&&(o(0,"mat-option",18),a(1," No hay veh\xEDculos compatibles disponibles. "),n()),e&2&&d("disabled",!0)}function Zi(e,i){if(e&1){let t=x();o(0,"td",12)(1,"div",13)(2,"mat-select",14),le("ngModelChange",function(s){let p=D(t).$implicit;return re(p.idVehiculoAsignado,s)||(p.idVehiculoAsignado=s),v(s)}),_("selectionChange",function(){let s=D(t).$implicit,p=u();return v(p.onVehiculoChange(s))}),o(3,"mat-option",15),a(4,"-- Sin Asignar --"),n(),m(5,Wi,2,2,"mat-option",16)(6,Yi,2,1,"mat-option",17),n()()()}if(e&2){let t=i.$implicit;l(2),ae("ngModel",t.idVehiculoAsignado),l(),d("value",null),l(2),d("ngForOf",t.opcionesVehiculo),l(),d("ngIf",!(t.opcionesVehiculo!=null&&t.opcionesVehiculo.length))}}function Ji(e,i){e&1&&C(0,"tr",19)}function Xi(e,i){e&1&&C(0,"tr",20)}var ze=class e{detalles=[];displayedColumns=["idLote","nombreProducto","cantidadProducto","condicionTransporte","asignacionVehiculo"];asignacionCambio=new V;onVehiculoChange(i){this.asignacionCambio.emit(i)}getVehiculoLabel(i){return`#${i.id} | ${i.placa} | ${i.tipoVehiculo||"N/A"}`}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=b({type:e,selectors:[["app-asignacion-lote-vehiculo-table"]],inputs:{detalles:"detalles"},outputs:{asignacionCambio:"asignacionCambio"},standalone:!1,decls:19,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","idLote"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombreProducto"],["matColumnDef","cantidadProducto"],["matColumnDef","condicionTransporte"],["matColumnDef","asignacionVehiculo"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["appearance","outline",1,"select-full-width"],[3,"ngModelChange","selectionChange","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[3,"disabled",4,"ngIf"],[3,"disabled"],["mat-header-row",""],["mat-row",""]],template:function(t,r){t&1&&(o(0,"div",0)(1,"table",1),f(2,2),m(3,ki,2,0,"th",3)(4,Bi,2,1,"td",4),g(),f(5,5),m(6,$i,2,0,"th",3)(7,Hi,2,1,"td",4),g(),f(8,6),m(9,ji,2,0,"th",3)(10,qi,2,1,"td",4),g(),f(11,7),m(12,Ui,2,0,"th",3)(13,zi,2,1,"td",4),g(),f(14,8),m(15,Gi,2,0,"th",3)(16,Zi,7,4,"td",4),g(),m(17,Ji,1,0,"tr",9)(18,Xi,1,0,"tr",10),n()()),t&2&&(l(),d("dataSource",r.detalles||L(3,Fi)),l(16),d("matHeaderRowDef",r.displayedColumns),l(),d("matRowDefColumns",r.displayedColumns))},dependencies:[we,ft,G,P,N,$,F,A,H,k,B,j,q,Q,de,Ae],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};function Qi(e,i){e&1&&(o(0,"div",11),C(1,"mat-progress-spinner",12),o(2,"p"),a(3,"Cargando lotes y veh\xEDculos disponibles..."),n()())}function en(e,i){if(e&1){let t=x();o(0,"div")(1,"p",13),a(2," Seleccione el veh\xEDculo adecuado para cada lote. El veh\xEDculo debe cumplir con la **condici\xF3n de transporte requerida** (ej: Ambiente, Fr\xEDo). "),n(),o(3,"app-asignacion-lote-vehiculo-table",14),_("asignacionCambio",function(s){D(t);let p=u();return v(p.onAsignacionChange(s))}),n()()}if(e&2){let t=u();l(3),d("detalles",t.detallesOrden)}}function tn(e,i){e&1&&(o(0,"div",15)(1,"mat-icon"),a(2,"info"),n(),o(3,"p"),a(4,"Esta orden no tiene lotes pendientes de asignaci\xF3n de veh\xEDculo."),n()())}function nn(e,i){e&1&&(o(0,"span"),a(1,"Confirmar Asignaci\xF3n"),n())}var Ge=class e{constructor(i,t,r){this.dialogRef=i;this.data=t;this.distribucionService=r;this.idOrden=t.idOrden}idOrden;detallesOrden=null;isLoading=!0;isSaving=!1;get isOrderFullyAssigned(){return this.detallesOrden?this.detallesOrden.every(i=>i.idVehiculoAsignado!==null):!1}ngOnInit(){this.cargarDetallesOrden()}cargarDetallesOrden(){this.isLoading=!0,this.distribucionService.getDetallesOrdenParaAsignacion(this.idOrden).pipe(E(()=>this.isLoading=!1)).subscribe({next:i=>{this.detallesOrden=i},error:i=>{console.error("Error al cargar detalles de la orden:",i),alert("Error al cargar detalles de la orden de distribuci\xF3n.")}})}onAsignacionChange(i){console.log(`Lote ${i.idLote} asignado a veh\xEDculo: ${i.idVehiculoAsignado}`)}onConfirmarAsignacion(){if(!this.isOrderFullyAssigned){alert("Debe asignar un veh\xEDculo a todos los lotes antes de confirmar.");return}this.detallesOrden&&(this.isSaving=!0,this.distribucionService.guardarAsignacionVehiculos(this.idOrden,this.detallesOrden).pipe(E(()=>this.isSaving=!1)).subscribe({next:()=>{this.dialogRef.close({success:!0,detallesActualizados:this.detallesOrden})},error:i=>{console.error("Error al guardar asignaci\xF3n:",i),alert("Error al guardar la asignaci\xF3n. Intente de nuevo.")}}))}onCancelar(){this.dialogRef.close({success:!1})}static \u0275fac=function(t){return new(t||e)(h(J),h(X),h(I))};static \u0275cmp=b({type:e,selectors:[["app-popup-lote-asignacion-vehiculo"]],standalone:!1,decls:14,vars:8,consts:[["color","primary"],[1,"dialog-title"],[1,"spacer"],[3,"click","disabled"],["mat-dialog-content","",1,"dialog-content"],["class","loading-state centered-content",4,"ngIf"],[4,"ngIf"],["class","empty-state centered-content",4,"ngIf"],["mat-dialog-actions","","align","end"],["type","button",3,"click","disabled"],["color","primary",3,"click","disabled"],[1,"loading-state","centered-content"],["mode","indeterminate","diameter","30"],[1,"text-sm","mb-4"],[3,"asignacionCambio","detalles"],[1,"empty-state","centered-content"]],template:function(t,r){t&1&&(o(0,"mat-toolbar",0)(1,"span",1),a(2),n(),C(3,"span",2),o(4,"button",3),_("click",function(){return r.onCancelar()}),n()(),o(5,"div",4),m(6,Qi,4,0,"div",5)(7,en,4,1,"div",6)(8,tn,5,0,"div",7),n(),o(9,"div",8)(10,"button",9),_("click",function(){return r.onCancelar()}),a(11," Cancelar "),n(),o(12,"button",10),_("click",function(){return r.onConfirmarAsignacion()}),m(13,nn,2,0,"span",6),n()()),t&2&&(l(2),c(" Asignar Veh\xEDculos a Orden N\xB0 ",r.idOrden," "),l(2),d("disabled",r.isSaving),l(2),d("ngIf",r.isLoading),l(),d("ngIf",!r.isLoading&&r.detallesOrden&&r.detallesOrden.length>0),l(),d("ngIf",!r.isLoading&&(!r.detallesOrden||r.detallesOrden.length===0)),l(2),d("disabled",r.isSaving),l(2),d("disabled",!r.isOrderFullyAssigned||r.isSaving),l(),d("ngIf",!r.isSaving))},dependencies:[ee,K,Y,te,G,vt,ze],encapsulation:2})};var We=class e{constructor(i,t){this.dialogRef=i;this.data=t}onConfirmar(){this.dialogRef.close({confirmado:!0})}onCancelar(){this.dialogRef.close({confirmado:!1})}static \u0275fac=function(t){return new(t||e)(h(J),h(X))};static \u0275cmp=b({type:e,selectors:[["app-popup-cancelar-orden"]],standalone:!1,decls:21,vars:3,consts:[["color","warn"],[1,"dialog-title"],[1,"spacer"],[3,"click"],["mat-dialog-content","",1,"dialog-content"],[1,"message-area"],["mat-dialog-actions","","align","end"],["mat-button","","type","button","color","default",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,r){t&1&&(o(0,"mat-toolbar",0)(1,"span",1),a(2),n(),C(3,"span",2),o(4,"button",3),_("click",function(){return r.onCancelar()}),a(5," Cerrar "),n()(),o(6,"div",4)(7,"div",5)(8,"p"),a(9),n(),o(10,"p")(11,"strong"),a(12,"\xCDtem:"),n(),a(13),n(),o(14,"p"),a(15,"\xBFDesea continuar con esta acci\xF3n?"),n()()(),o(16,"div",6)(17,"button",7),_("click",function(){return r.onCancelar()}),a(18," Cancelar "),n(),o(19,"button",8),_("click",function(){return r.onConfirmar()}),a(20," Confirmar Entrega "),n()()),t&2&&(l(2),U(r.data.titulo),l(7),U(r.data.mensaje),l(4),c(" ",r.data.itemNombre))},dependencies:[ee,K,Y,Z],encapsulation:2})};var on=()=>[];function an(e,i){e&1&&(o(0,"th",15),a(1," OC N\xB0 "),n())}function rn(e,i){if(e&1&&(o(0,"td",16),a(1),n()),e&2){let t=i.$implicit;l(),c(" **",t.idOrden,"** ")}}function ln(e,i){e&1&&(o(0,"th",15),a(1," Req. N\xB0 "),n())}function cn(e,i){if(e&1&&(o(0,"td",16),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.idRequerimiento," ")}}function sn(e,i){e&1&&(o(0,"th",15),a(1," Solicitante "),n())}function dn(e,i){if(e&1&&(o(0,"td",16),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.nombreUsuario," ")}}function mn(e,i){e&1&&(o(0,"th",15),a(1," \xC1rea "),n())}function pn(e,i){if(e&1&&(o(0,"td",16),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.area," ")}}function un(e,i){e&1&&(o(0,"th",15),a(1," Estado "),n())}function fn(e,i){if(e&1&&(o(0,"td",16),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.estado," ")}}function gn(e,i){e&1&&(o(0,"th",15),a(1," Prioridad "),n())}function Cn(e,i){if(e&1&&(o(0,"td",16),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.prioridad," ")}}function _n(e,i){e&1&&(o(0,"th",15),a(1," Entrega Est. "),n())}function hn(e,i){if(e&1&&(o(0,"td",16),a(1),R(2,"date"),n()),e&2){let t=i.$implicit;l(),c(" ",w(2,1,t.fechaEntregaEstimada,"dd/MM/yyyy")," ")}}function bn(e,i){e&1&&(o(0,"th",15),a(1," Designar Movilidad "),n())}function Dn(e,i){if(e&1){let t=x();o(0,"td",16)(1,"button",17),_("click",function(){let s=D(t).$implicit,p=u();return v(p.onDesignarMovilidad(s.idOrden))}),a(2," Designar Movilidad "),n()()}if(e&2){let t=i.$implicit;l(),d("disabled",t.estado!=="Pendiente")}}function vn(e,i){e&1&&(o(0,"th",15),a(1," Cancelar Orden "),n())}function xn(e,i){if(e&1){let t=x();o(0,"td",16)(1,"button",18),_("click",function(){let s=D(t).$implicit,p=u();return v(p.onCancelarOrden(s.idOrden))}),a(2," Cancelar Orden "),n()()}}function En(e,i){e&1&&C(0,"tr",19)}function Tn(e,i){e&1&&C(0,"tr",20)}var Ye=class e{ordenes=[];displayedColumns=["id","idRequerimiento","nombreUsuario","area","estado","prioridad","fechaEntregaEstimada","designarMovilidad","cancelarOrden"];designarMovilidad=new V;cancelarOrden=new V;onDesignarMovilidad(i){this.designarMovilidad.emit(i)}onCancelarOrden(i){this.cancelarOrden.emit(i)}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=b({type:e,selectors:[["app-ordenes-distribucion-table"]],inputs:{ordenes:"ordenes"},outputs:{designarMovilidad:"designarMovilidad",cancelarOrden:"cancelarOrden"},standalone:!1,decls:31,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","idOrden"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","idRequerimiento"],["matColumnDef","nombreUsuario"],["matColumnDef","area"],["matColumnDef","estado"],["matColumnDef","prioridad"],["matColumnDef","fechaEntregaEstimada"],["matColumnDef","designarMovilidad"],["matColumnDef","cancelarOrden"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["color","accent",3,"click","disabled"],["color","accent",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,r){t&1&&(o(0,"div",0)(1,"table",1),f(2,2),m(3,an,2,0,"th",3)(4,rn,2,1,"td",4),g(),f(5,5),m(6,ln,2,0,"th",3)(7,cn,2,1,"td",4),g(),f(8,6),m(9,sn,2,0,"th",3)(10,dn,2,1,"td",4),g(),f(11,7),m(12,mn,2,0,"th",3)(13,pn,2,1,"td",4),g(),f(14,8),m(15,un,2,0,"th",3)(16,fn,2,1,"td",4),g(),f(17,9),m(18,gn,2,0,"th",3)(19,Cn,2,1,"td",4),g(),f(20,10),m(21,_n,2,0,"th",3)(22,hn,3,4,"td",4),g(),f(23,11),m(24,bn,2,0,"th",3)(25,Dn,3,1,"td",4),g(),f(26,12),m(27,vn,2,0,"th",3)(28,xn,3,0,"td",4),g(),m(29,En,1,0,"tr",13)(30,Tn,1,0,"tr",14),n()()),t&2&&(l(),d("dataSource",r.ordenes||L(3,on)),l(28),d("matHeaderRowDef",r.displayedColumns),l(),d("matRowDefColumns",r.displayedColumns))},dependencies:[P,N,$,F,A,H,k,B,j,q,W],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};var Sn=["class","component"];function Mn(e,i){if(e&1){let t=x();o(0,"app-ordenes-distribucion-table",6),_("designarMovilidad",function(s){D(t);let p=u();return v(p.onDesignarMovilidad(s))})("cancelarOrden",function(s){D(t);let p=u();return v(p.onCancelarOrden(s))}),n()}if(e&2){let t=u();d("ordenes",t.getOrdenesFiltradas())}}function On(e,i){e&1&&(o(0,"div",5)(1,"h2"),a(2,"No hay \xD3rdenes Pendientes"),n(),o(3,"p"),a(4,"No se encontraron \xF3rdenes de distribuci\xF3n que requieran asignaci\xF3n de veh\xEDculos."),n()())}var Ee=class e{constructor(i,t){this.distribucionService=i;this.dialog=t}ordenes=null;isLoading=!0;filtroBusqueda="";ngOnInit(){this.cargarOrdenes()}cargarOrdenes(){this.isLoading=!0,this.distribucionService.getOrdenesDistribucion().pipe(E(()=>this.isLoading=!1)).subscribe({next:i=>{this.ordenes=i},error:i=>{console.error("Error al cargar \xF3rdenes de distribuci\xF3n:",i)}})}getOrdenesFiltradas(){if(!this.ordenes)return null;if(!this.filtroBusqueda)return this.ordenes;let i=this.filtroBusqueda.toLowerCase();return this.ordenes.filter(t=>t.id.toString().includes(i)||t.nombreUsuario&&t.nombreUsuario.toLowerCase().includes(i)||t.area&&t.area.toLowerCase().includes(i))}onDesignarMovilidad(i){let t={idOrden:i};this.dialog.open(Ge,{width:"900px",data:t}).afterClosed().subscribe(s=>{s?.success&&this.actualizarEstadoOrdenLocal(i,"Programada")})}actualizarEstadoOrdenLocal(i,t){if(!this.ordenes)return;let r=this.ordenes.findIndex(s=>s.id===i);r!==-1&&(this.ordenes[r]=De(be({},this.ordenes[r]),{estado:t}),this.ordenes=[...this.ordenes])}onCancelarOrden(i){let t={titulo:"Confirmaci\xF3n de Cancelaci\xF3n",mensaje:`\xBFEst\xE1 seguro de CANCELAR la Orden de Distribuci\xF3n N\xB0 ${i}? Esto detendr\xE1 el proceso de entrega.`,itemNombre:`Orden N\xB0 ${i}`};this.dialog.open(We,{width:"450px",data:t}).afterClosed().subscribe(s=>{s?.confirmado&&this.ejecutarCancelacion(i)})}ejecutarCancelacion(i){this.distribucionService.cancelarOrden(i).pipe(E(()=>this.isLoading=!1)).subscribe({next:()=>{alert(`Orden N\xB0 ${i} cancelada con \xE9xito.`),this.actualizarEstadoOrdenLocal(i,"Cancelada")},error:t=>{console.error("Error al cancelar orden:",t),alert(`Error: No se pudo cancelar la Orden N\xB0 ${i}.`)}})}static \u0275fac=function(t){return new(t||e)(h(I),h(Ce))};static \u0275cmp=b({type:e,selectors:[["app-ordenes-distribucion-list",8,"component"]],standalone:!1,attrs:Sn,decls:12,vars:2,consts:[[1,"page-container"],[1,"card-section"],[1,"search-bar"],["type","text","placeholder","Buscar por N\xB0 de Orden, Solicitante o \xC1rea",3,"ngModelChange","ngModel"],[3,"ordenes"],[1,"empty-state","centered-content"],[3,"designarMovilidad","cancelarOrden","ordenes"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"h2"),a(2,"Lista de \xD3rdenes de Distribuci\xF3n"),n(),o(3,"mat-card",1)(4,"h3"),a(5,"\xD3rdenes pendientes y en proceso de distribuci\xF3n."),n(),o(6,"div",2)(7,"h3"),a(8,"Buscar Orden"),n(),o(9,"input",3),le("ngModelChange",function(p){return re(r.filtroBusqueda,p)||(r.filtroBusqueda=p),p}),n()(),S(10,Mn,1,1,"app-ordenes-distribucion-table",4)(11,On,5,0,"div",5),n()()),t&2&&(l(9),ae("ngModel",r.filtroBusqueda),l(),M(r.getOrdenesFiltradas()&&r.getOrdenesFiltradas().length>0?10:11))},dependencies:[y,se,Q,de,Ye],encapsulation:2})};function Ln(e,i){e&1&&(o(0,"div",8),C(1,"mat-progress-spinner",9),o(2,"p"),a(3,"Cargando datos del lote..."),n()())}function yn(e,i){if(e&1&&(o(0,"div")(1,"mat-card",10)(2,"p")(3,"strong"),a(4,"N\xB0 de Lote:"),n(),a(5),n(),o(6,"p")(7,"strong"),a(8,"ID Producto:"),n(),a(9),n(),o(10,"p")(11,"strong"),a(12,"Estado:"),n(),a(13),n(),C(14,"mat-divider"),o(15,"p")(16,"strong"),a(17,"Cantidad Inicial:"),n(),a(18),n(),o(19,"p")(20,"strong"),a(21,"Cantidad Actual:"),n(),a(22),n(),C(23,"mat-divider"),o(24,"p")(25,"strong"),a(26,"Fecha de Fabricaci\xF3n:"),n(),a(27),R(28,"date"),n(),o(29,"p")(30,"strong"),a(31,"Fecha de Vencimiento:"),n(),a(32),R(33,"date"),n()()()),e&2){let t=u();l(5),c(" ",t.lote.numeroLote),l(4),c(" ",t.lote.idProducto),l(4),c(" ",t.lote.estado),l(5),c(" ",t.lote.cantInicial),l(4),c(" ",t.lote.cantActual),l(5),c(" ",w(28,7,t.lote.fechaFabricacion,"dd/MM/yyyy")),l(5),c(" ",w(33,10,t.lote.fechaVencimiento,"dd/MM/yyyy"))}}function Vn(e,i){e&1&&(o(0,"div",11)(1,"p"),a(2,"No se encontraron detalles para el lote especificado."),n()())}var Ze=class e{constructor(i,t,r){this.dialogRef=i;this.data=t;this.distribucionService=r}lote=null;isLoading=!0;ngOnInit(){this.cargarInfoLote(this.data.idLote)}cargarInfoLote(i){this.isLoading=!0,this.distribucionService.getInfoLote(i).pipe(E(()=>this.isLoading=!1)).subscribe({next:t=>{this.lote=t},error:t=>{console.error("Error al cargar informaci\xF3n del lote:",t),alert("Error al cargar la informaci\xF3n del lote.")}})}onClose(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||e)(h(J),h(X),h(I))};static \u0275cmp=b({type:e,selectors:[["app-popup-info-lote"]],standalone:!1,decls:10,vars:4,consts:[["color","accent"],[1,"dialog-title"],[1,"spacer"],["mat-button","",3,"click"],["mat-dialog-content","",1,"dialog-content"],["class","loading-state centered-content",4,"ngIf"],[4,"ngIf"],["class","empty-state centered-content",4,"ngIf"],[1,"loading-state","centered-content"],["mode","indeterminate","diameter","30"],[1,"info-card"],[1,"empty-state","centered-content"]],template:function(t,r){t&1&&(o(0,"mat-toolbar",0)(1,"span",1),a(2),n(),C(3,"span",2),o(4,"button",3),_("click",function(){return r.onClose()}),a(5," Cerrar "),n()(),o(6,"div",4),m(7,Ln,4,0,"div",5)(8,yn,34,13,"div",6)(9,Vn,3,0,"div",7),n()),t&2&&(l(2),c(" Informaci\xF3n Detallada del Lote N\xB0 ",r.data.idLote," "),l(5),d("ngIf",r.isLoading),l(),d("ngIf",!r.isLoading&&r.lote),l(),d("ngIf",!r.isLoading&&!r.lote))},dependencies:[K,Y,te,G,Z,y,Re,W],encapsulation:2})};var Rn=()=>[];function wn(e,i){e&1&&(o(0,"th",10),a(1," Lote N\xB0 "),n())}function Pn(e,i){if(e&1&&(o(0,"td",11),a(1),n()),e&2){let t=i.$implicit;l(),c(" **",t.idLote,"** ")}}function An(e,i){e&1&&(o(0,"th",10),a(1," Producto "),n())}function Nn(e,i){if(e&1&&(o(0,"td",11),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.nombreProducto," ")}}function Fn(e,i){e&1&&(o(0,"th",10),a(1," Cantidad "),n())}function kn(e,i){if(e&1&&(o(0,"td",11),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.cantidadTransportada," ")}}function Bn(e,i){e&1&&(o(0,"th",10),a(1," Acci\xF3n "),n())}function $n(e,i){if(e&1){let t=x();o(0,"td",11)(1,"button",12),_("click",function(){let s=D(t).$implicit,p=u();return v(p.onVerInfoLote(s.idLote))}),a(2," Ver Info Lote "),n()()}}function Hn(e,i){e&1&&C(0,"tr",13)}function jn(e,i){e&1&&C(0,"tr",14)}var Je=class e{detalles=[];displayedColumns=["idLote","nombreProducto","cantidadTransportada","accion"];verInfoLote=new V;onVerInfoLote(i){this.verInfoLote.emit(i)}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=b({type:e,selectors:[["app-vehiculo-lotes-table"]],inputs:{detalles:"detalles"},outputs:{verInfoLote:"verInfoLote"},standalone:!1,decls:16,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","idLote"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombreProducto"],["matColumnDef","cantidadTransportada"],["matColumnDef","accion"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-button","","color","accent",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,r){t&1&&(o(0,"div",0)(1,"table",1),f(2,2),m(3,wn,2,0,"th",3)(4,Pn,2,1,"td",4),g(),f(5,5),m(6,An,2,0,"th",3)(7,Nn,2,1,"td",4),g(),f(8,6),m(9,Fn,2,0,"th",3)(10,kn,2,1,"td",4),g(),f(11,7),m(12,Bn,2,0,"th",3)(13,$n,3,0,"td",4),g(),m(14,Hn,1,0,"tr",8)(15,jn,1,0,"tr",9),n()()),t&2&&(l(),d("dataSource",r.detalles||L(3,Rn)),l(13),d("matHeaderRowDef",r.displayedColumns),l(),d("matRowDefColumns",r.displayedColumns))},dependencies:[P,N,$,F,A,H,k,B,j,q,Z],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};var Un=["class","component"],zn=()=>["/GestionDistribucion/monitoreo"];function Gn(e,i){e&1&&(o(0,"div",3),C(1,"mat-progress-spinner",6),o(2,"p"),a(3,"Cargando lotes..."),n()())}function Wn(e,i){if(e&1){let t=x();o(0,"app-vehiculo-lotes-table",9),_("verInfoLote",function(s){D(t);let p=u(2);return v(p.onVerInfoLote(s))}),n()}if(e&2){let t=u(2);d("detalles",t.detallesTransporte)}}function Yn(e,i){e&1&&(o(0,"div",8)(1,"h2"),a(2,"No hay Lotes Asignados"),n(),o(3,"p"),a(4,"Este seguimiento no tiene lotes registrados para el transporte."),n()())}function Zn(e,i){if(e&1&&S(0,Wn,1,1,"app-vehiculo-lotes-table",7)(1,Yn,5,0,"div",8),e&2){let t=u();M(t.detallesTransporte&&t.detallesTransporte.length>0?0:1)}}var Xe=class e{constructor(i,t,r){this.distribucionService=i;this.dialog=t;this.route=r}idSeguimiento=0;detallesTransporte=null;isLoading=!0;infoSeguimiento={placa:"[Cargando...]",destino:"[Cargando...]"};ngOnInit(){this.route.paramMap.subscribe(i=>{let t=i.get("idSeguimiento");t?(this.idSeguimiento=+t,this.cargarDetallesLotes(this.idSeguimiento),this.infoSeguimiento={placa:"ABC-123",destino:"Hospital Central"}):(console.error("ID de seguimiento no encontrado."),this.isLoading=!1)})}cargarDetallesLotes(i){this.isLoading=!0,this.distribucionService.getLotesBySeguimientoId(i).pipe(E(()=>this.isLoading=!1)).subscribe({next:t=>{this.detallesTransporte=t},error:t=>{console.error("Error al cargar lotes del seguimiento:",t),alert("Error al cargar la lista de lotes.")}})}onVerInfoLote(i){let t={idLote:i};this.dialog.open(Ze,{width:"500px",data:t})}static \u0275fac=function(t){return new(t||e)(h(I),h(Ce),h(ge))};static \u0275cmp=b({type:e,selectors:[["app-vehiculo-lotes-list",8,"component"]],standalone:!1,attrs:Un,decls:22,vars:6,consts:[[1,"page-container"],[1,"card-section","header-details"],[1,"card-section","table-container"],[1,"loading-state","centered-content"],[1,"footer-actions"],["mat-button","",3,"routerLink"],["mode","indeterminate","diameter","50"],[3,"detalles"],[1,"empty-state","centered-content"],[3,"verInfoLote","detalles"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"h2"),a(2),n(),o(3,"mat-card",1)(4,"h3"),a(5,"Detalles del Transporte"),n(),o(6,"p")(7,"strong"),a(8,"Veh\xEDculo:"),n(),a(9),n(),o(10,"p")(11,"strong"),a(12,"Pr\xF3ximo Destino:"),n(),a(13),n()(),o(14,"mat-card",2)(15,"h3"),a(16,"Lotes Transportados"),n(),S(17,Gn,4,0,"div",3)(18,Zn,2,1),n(),o(19,"div",4)(20,"button",5),a(21," Volver a Monitoreo de Veh\xEDculos "),n()()()),t&2&&(l(2),c("Lotes en Tr\xE1nsito (Seguimiento N\xB0 ",r.idSeguimiento,")"),l(7),c(" ",r.infoSeguimiento.placa),l(4),c(" ",r.infoSeguimiento.destino),l(4),M(r.isLoading?17:18),l(3),d("routerLink",L(5,zn)))},dependencies:[te,_t,Z,y,Je],encapsulation:2})};var Jn=()=>[];function Xn(e,i){e&1&&(o(0,"th",13),a(1," Fecha Reporte "),n())}function Kn(e,i){if(e&1&&(o(0,"td",14),a(1),R(2,"date"),n()),e&2){let t=i.$implicit;l(),c(" ",w(2,1,t.fechaReporte,"dd/MM/yyyy HH:mm")," ")}}function Qn(e,i){e&1&&(o(0,"th",13),a(1," Tipo "),n())}function eo(e,i){if(e&1&&(o(0,"td",14),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.tipoIncidencia," ")}}function to(e,i){e&1&&(o(0,"th",13),a(1," Impacto "),n())}function io(e,i){if(e&1&&(o(0,"td",14)(1,"span",15),a(2),n()()),e&2){let t=i.$implicit,r=u();l(),d("ngClass",r.getImpactoClass(t.impacto)),l(),c(" ",t.impacto," ")}}function no(e,i){e&1&&(o(0,"th",13),a(1," Lote Afectado "),n())}function oo(e,i){e&1&&(o(0,"span",17),a(1,"(Veh\xEDculo/Orden)"),n())}function ao(e,i){if(e&1&&(o(0,"td",14),a(1),m(2,oo,2,0,"span",16),n()),e&2){let t=i.$implicit;l(),c(" ",t.idDetalleDist||"General"," "),l(),d("ngIf",!t.idDetalleDist)}}function ro(e,i){e&1&&(o(0,"th",13),a(1," Descripci\xF3n "),n())}function lo(e,i){if(e&1&&(o(0,"td",14),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.descripcion," ")}}function co(e,i){e&1&&(o(0,"th",13),a(1," Reportado por "),n())}function so(e,i){if(e&1&&(o(0,"td",14),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.usuarioReporta," ")}}function mo(e,i){e&1&&C(0,"tr",18)}function po(e,i){e&1&&C(0,"tr",19)}function uo(e,i){if(e&1&&(o(0,"tr",20)(1,"td",21),a(2," No se han registrado incidencias para esta Orden. "),n()()),e&2){let t=u();l(),mt("colspan",t.displayedColumns.length)}}var Ke=class e{incidencias=[];displayedColumns=["fechaReporte","tipoIncidencia","impacto","idLoteAfectado","descripcion","usuarioReporta"];getImpactoClass(i){switch(i){case"Alto":return"impacto-alto";case"Moderado":return"impacto-moderado";case"Bajo":default:return"impacto-bajo"}}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=b({type:e,selectors:[["app-reporte-incidencias-table"]],inputs:{incidencias:"incidencias"},standalone:!1,decls:23,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","fechaReporte"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","tipoIncidencia"],["matColumnDef","impacto"],["matColumnDef","idLoteAfectado"],["matColumnDef","descripcion"],["matColumnDef","usuarioReporta"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell",""],["mat-cell",""],[3,"ngClass"],["class","text-xs text-gray-500",4,"ngIf"],[1,"text-xs","text-gray-500"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"table",1),f(2,2),m(3,Xn,2,0,"th",3)(4,Kn,3,4,"td",4),g(),f(5,5),m(6,Qn,2,0,"th",3)(7,eo,2,1,"td",4),g(),f(8,6),m(9,to,2,0,"th",3)(10,io,3,2,"td",4),g(),f(11,7),m(12,no,2,0,"th",3)(13,ao,3,2,"td",4),g(),f(14,8),m(15,ro,2,0,"th",3)(16,lo,2,1,"td",4),g(),f(17,9),m(18,co,2,0,"th",3)(19,so,2,1,"td",4),g(),m(20,mo,1,0,"tr",10)(21,po,1,0,"tr",11)(22,uo,3,1,"tr",12),n()()),t&2&&(l(),d("dataSource",r.incidencias||L(3,Jn)),l(19),d("matHeaderRowDef",r.displayedColumns),l(),d("matRowDefColumns",r.displayedColumns))},dependencies:[ut,G,P,N,$,F,A,H,k,B,j,q,Vt,W],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};var go=["class","component"];function Co(e,i){if(e&1&&C(0,"app-reporte-incidencias-table",3),e&2){let t=u();d("incidencias",t.incidencias)}}function _o(e,i){if(e&1&&(o(0,"div",4)(1,"h3",5),a(2,"Sin Incidencias Registradas"),n(),o(3,"p"),a(4),n()()),e&2){let t=u();l(4),c("La Orden N\xB0 ",t.idOrden," fue entregada sin ning\xFAn reporte de novedad o problema.")}}var Qe=class e{constructor(i,t,r){this.route=i;this.router=t;this.distribucionService=r}idOrden=null;incidencias=null;isLoading=!0;errorCarga=null;ngOnInit(){this.route.paramMap.pipe(Ie(i=>{let t=i.get("idOrden");return t?(this.idOrden=+t,this.distribucionService.getIncidenciasByOrdenId(this.idOrden)):(this.errorCarga="ID de Orden no proporcionado en la URL.",z(null))}),E(()=>this.isLoading=!1)).subscribe({next:i=>{i&&(this.incidencias=i)},error:i=>{this.errorCarga="Ocurri\xF3 un error al intentar cargar las incidencias desde el servidor.",this.incidencias=[]}})}goBack(){this.router.navigate(["/GestionDistribucion/reportes/entregas"])}static \u0275fac=function(t){return new(t||e)(h(ge),h(ce),h(I))};static \u0275cmp=b({type:e,selectors:[["app-incidencias-reporte",8,"component"]],standalone:!1,attrs:go,decls:8,vars:2,consts:[[1,"page-container"],["color","primary",1,"back-button",3,"click"],[1,"card-section"],[3,"incidencias"],[1,"empty-state","centered-content"],[1,"mt-2"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"button",1),_("click",function(){return r.goBack()}),a(2," Volver a Reportes de Entrega "),n(),o(3,"h2"),a(4),n(),o(5,"mat-card",2),S(6,Co,1,1,"app-reporte-incidencias-table",3)(7,_o,5,1,"div",4),n()()),t&2&&(l(4),c("Incidencias Reportadas para Orden de Distribuci\xF3n N\xB0 **",r.idOrden,"**"),l(2),M(r.incidencias&&r.incidencias.length>0?6:7))},dependencies:[y,Ke],encapsulation:2})};var ho=()=>[];function bo(e,i){e&1&&(o(0,"th",11),a(1," Lote N\xB0 "),n())}function Do(e,i){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let t=i.$implicit;l(),c(" **",t.idLote,"** ")}}function vo(e,i){e&1&&(o(0,"th",11),a(1," Producto "),n())}function xo(e,i){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.nombreProducto," ")}}function Eo(e,i){e&1&&(o(0,"th",11),a(1," Cantidad "),n())}function To(e,i){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.cantidadProducto," ")}}function Io(e,i){e&1&&(o(0,"th",11),a(1," Condici\xF3n Req. "),n())}function So(e,i){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.condicionTransporteRequerida," ")}}function Mo(e,i){e&1&&(o(0,"th",11),a(1," Veh\xEDculo Asignado "),n())}function Oo(e,i){if(e&1&&(o(0,"td",12),a(1),n()),e&2){let t=i.$implicit;l(),c(" #",t.idVehiculoAsignado," ")}}function Lo(e,i){e&1&&C(0,"tr",13)}function yo(e,i){e&1&&C(0,"tr",14)}var et=class e{detalles=[];displayedColumns=["idLote","nombreProducto","cantidadProducto","condicionTransporteRequerida","idVehiculoAsignado"];static \u0275fac=function(t){return new(t||e)};static \u0275cmp=b({type:e,selectors:[["app-reporte-detalle-lotes-table"]],inputs:{detalles:"detalles"},standalone:!1,decls:19,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","idLote"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombreProducto"],["matColumnDef","cantidadProducto"],["matColumnDef","condicionTransporteRequerida"],["matColumnDef","idVehiculoAsignado"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(t,r){t&1&&(o(0,"div",0)(1,"table",1),f(2,2),m(3,bo,2,0,"th",3)(4,Do,2,1,"td",4),g(),f(5,5),m(6,vo,2,0,"th",3)(7,xo,2,1,"td",4),g(),f(8,6),m(9,Eo,2,0,"th",3)(10,To,2,1,"td",4),g(),f(11,7),m(12,Io,2,0,"th",3)(13,So,2,1,"td",4),g(),f(14,8),m(15,Mo,2,0,"th",3)(16,Oo,2,1,"td",4),g(),m(17,Lo,1,0,"tr",9)(18,yo,1,0,"tr",10),n()()),t&2&&(l(),d("dataSource",r.detalles||L(3,ho)),l(16),d("matHeaderRowDef",r.displayedColumns),l(),d("matRowDefColumns",r.displayedColumns))},dependencies:[P,N,$,F,A,H,k,B,j,q],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};var Ro=["class","component"];function wo(e,i){if(e&1&&(o(0,"div",2)(1,"h3"),a(2,"Error de Carga"),n(),o(3,"p"),a(4),n()()),e&2){let t=u();l(4),U(t.errorCarga)}}function Po(e,i){if(e&1&&(o(0,"div",3)(1,"mat-card",5)(2,"h3"),a(3,"Resumen de la Orden"),n(),o(4,"p")(5,"strong"),a(6,"Solicitante:"),n(),a(7),n(),o(8,"p")(9,"strong"),a(10,"\xC1rea Destino:"),n(),a(11),n(),o(12,"p")(13,"strong"),a(14,"Fecha Entrega:"),n(),a(15),R(16,"date"),n(),o(17,"p")(18,"strong"),a(19,"Estado Final:"),n(),o(20,"span",6),a(21),n()()(),o(22,"mat-card",5)(23,"h3"),a(24,"Detalles de Transporte"),n(),o(25,"p")(26,"strong"),a(27,"Veh\xEDculo ID:"),n(),a(28),n(),o(29,"p")(30,"strong"),a(31,"Destino Final:"),n(),a(32),n(),o(33,"p")(34,"strong"),a(35,"Ubicaci\xF3n Cierre:"),n(),a(36),n(),o(37,"p")(38,"strong"),a(39,"Fecha Cierre:"),n(),a(40),R(41,"date"),n()(),o(42,"mat-card",7)(43,"h3"),a(44),n(),C(45,"app-reporte-detalle-lotes-table",8),n(),o(46,"mat-card",9)(47,"h3"),a(48,"Notas y Justificaci\xF3n de Cierre"),n(),o(49,"p",10),a(50),n()()()),e&2){let t=u();l(7),c(" ",t.detalleCompleto.orden.nombreUsuario),l(4),c(" ",t.detalleCompleto.orden.area),l(4),c(" ",w(16,12,t.detalleCompleto.orden.fechaEntregaEstimada,"dd/MM/yyyy")),l(6),U(t.detalleCompleto.orden.estado),l(7),fe(" #",t.detalleCompleto.infoSeguimiento.idVehiculo," (",t.detalleCompleto.infoSeguimiento.placaVehiculo,")"),l(4),c(" ",t.detalleCompleto.infoSeguimiento.proximoDestino),l(4),c(" ",t.detalleCompleto.infoSeguimiento.ubicacionActual),l(4),c(" ",w(41,15,t.detalleCompleto.infoSeguimiento.fechaHoraActualizacion,"dd/MM/yyyy HH:mm")),l(4),c("Lotes Transportados (",t.detalleCompleto.detallesLotes.length," \xEDtems)"),l(),d("detalles",t.detalleCompleto.detallesLotes),l(5),U(t.detalleCompleto.justificacionCierre||"No se registraron notas de cierre para esta entrega.")}}function Ao(e,i){if(e&1&&(o(0,"div",4)(1,"h3",11),a(2,"Reporte no Disponible"),n(),o(3,"p"),a(4),n()()),e&2){let t=u();l(4),c("No se encontraron datos completos para la Orden N\xB0 ",t.idOrden,".")}}var tt=class e{constructor(i,t,r){this.route=i;this.router=t;this.distribucionService=r}idOrden=null;detalleCompleto=null;isLoading=!0;errorCarga=null;ngOnInit(){this.route.paramMap.pipe(Ie(i=>{let t=i.get("idOrden");return t?(this.idOrden=+t,this.distribucionService.getDetalleReporteOrden(this.idOrden)):(this.errorCarga="ID de Orden no proporcionado.",z(null))}),E(()=>this.isLoading=!1)).subscribe({next:i=>{i&&(this.detalleCompleto=i)},error:i=>{console.error("Error al cargar detalle de reporte:",i),this.errorCarga="Ocurri\xF3 un error al intentar cargar el reporte completo."}})}goBack(){this.router.navigate(["/GestionDistribucion/reportes"])}static \u0275fac=function(t){return new(t||e)(h(ge),h(ce),h(I))};static \u0275cmp=b({type:e,selectors:[["app-detalles-reporte",8,"component"]],standalone:!1,attrs:Ro,decls:8,vars:2,consts:[[1,"page-container"],["color","primary",1,"back-button",3,"click"],[1,"error-state","centered-content"],[1,"report-content-grid"],[1,"empty-state","centered-content"],[1,"card-section","info-card"],[1,"font-bold","text-green-600"],[1,"card-section","table-card","full-width"],[3,"detalles"],[1,"card-section","full-width"],[1,"text-gray-700","whitespace-pre-wrap"],[1,"mt-2"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"button",1),_("click",function(){return r.goBack()}),a(2," Volver a Reportes de Entrega "),n(),o(3,"h2"),a(4),n(),S(5,wo,5,1,"div",2)(6,Po,51,18,"div",3)(7,Ao,5,1,"div",4),n()),t&2&&(l(4),c("Detalle Completo de Orden N\xB0 **",r.idOrden,"**"),l(),M(r.errorCarga?5:r.detalleCompleto?6:7))},dependencies:[y,et,W],encapsulation:2})};var No=()=>[];function Fo(e,i){e&1&&(o(0,"th",14),a(1," OC N\xB0 "),n())}function ko(e,i){if(e&1&&(o(0,"td",15),a(1),n()),e&2){let t=i.$implicit;l(),c(" **",t.idOrden,"** ")}}function Bo(e,i){e&1&&(o(0,"th",14),a(1," Req. N\xB0 "),n())}function $o(e,i){if(e&1&&(o(0,"td",15),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.idRequerimiento," ")}}function Ho(e,i){e&1&&(o(0,"th",14),a(1," Solicitante "),n())}function jo(e,i){if(e&1&&(o(0,"td",15),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.nombreUsuario," ")}}function qo(e,i){e&1&&(o(0,"th",14),a(1," \xC1rea "),n())}function Uo(e,i){if(e&1&&(o(0,"td",15),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.area," ")}}function zo(e,i){e&1&&(o(0,"th",14),a(1," Fecha Entrega "),n())}function Go(e,i){if(e&1&&(o(0,"td",15),a(1),R(2,"date"),n()),e&2){let t=i.$implicit;l(),c(" ",w(2,1,t.fechaEntregaEstimada,"dd/MM/yyyy")," ")}}function Wo(e,i){e&1&&(o(0,"th",14),a(1," Lotes "),n())}function Yo(e,i){if(e&1&&(o(0,"td",15),a(1),n()),e&2){let t=i.$implicit;l(),c(" ",t.totalLotes," ")}}function Zo(e,i){e&1&&(o(0,"th",14),a(1," Detalles "),n())}function Jo(e,i){if(e&1){let t=x();o(0,"td",15)(1,"button",16),_("click",function(){let s=D(t).$implicit,p=u();return v(p.onVerDetalles(s.idOrden))}),a(2," Ver Detalle "),n()()}}function Xo(e,i){e&1&&(o(0,"th",14),a(1," Incidencias "),n())}function Ko(e,i){if(e&1){let t=x();o(0,"td",15)(1,"button",17),_("click",function(){let s=D(t).$implicit,p=u();return v(p.onVerIncidencias(s.idOrden))}),a(2),n()()}if(e&2){let t=i.$implicit;l(),d("disabled",!t.tieneIncidencias),l(),c(" ",t.tieneIncidencias?"Ver":"N/A"," ")}}function Qo(e,i){e&1&&C(0,"tr",18)}function ea(e,i){e&1&&C(0,"tr",19)}var it=class e{ordenes=[];displayedColumns=["idOrden","idRequerimiento","nombreUsuario","area","fechaEntregaEstimada","totalLotes","accionDetalle","accionIncidencia"];verDetalles=new V;verIncidencias=new V;onVerDetalles(i){this.verDetalles.emit(i)}onVerIncidencias(i){this.verIncidencias.emit(i)}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=b({type:e,selectors:[["app-reporte-ordenes-table"]],inputs:{ordenes:"ordenes"},outputs:{verDetalles:"verDetalles",verIncidencias:"verIncidencias"},standalone:!1,decls:28,vars:4,consts:[[1,"table-container","mat-elevation-z2"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","idOrden"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","idRequerimiento"],["matColumnDef","nombreUsuario"],["matColumnDef","area"],["matColumnDef","fechaEntregaEstimada"],["matColumnDef","totalLotes"],["matColumnDef","accionDetalle"],["matColumnDef","accionIncidencia"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["color","primary",3,"click"],["color","warn",3,"click","disabled"],["mat-header-row",""],["mat-row",""]],template:function(t,r){t&1&&(o(0,"div",0)(1,"table",1),f(2,2),m(3,Fo,2,0,"th",3)(4,ko,2,1,"td",4),g(),f(5,5),m(6,Bo,2,0,"th",3)(7,$o,2,1,"td",4),g(),f(8,6),m(9,Ho,2,0,"th",3)(10,jo,2,1,"td",4),g(),f(11,7),m(12,qo,2,0,"th",3)(13,Uo,2,1,"td",4),g(),f(14,8),m(15,zo,2,0,"th",3)(16,Go,3,4,"td",4),g(),f(17,9),m(18,Wo,2,0,"th",3)(19,Yo,2,1,"td",4),g(),f(20,10),m(21,Zo,2,0,"th",3)(22,Jo,3,0,"td",4),g(),f(23,11),m(24,Xo,2,0,"th",3)(25,Ko,3,2,"td",4),g(),m(26,Qo,1,0,"tr",12)(27,ea,1,0,"tr",13),n()()),t&2&&(l(),d("dataSource",r.ordenes||L(3,No)),l(25),d("matHeaderRowDef",r.displayedColumns),l(),d("matRowDefColumns",r.displayedColumns))},dependencies:[P,N,$,F,A,H,k,B,j,q,W],styles:[".table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}table[_ngcontent-%COMP%]{width:100%}th[_ngcontent-%COMP%]{background-color:#e0f0ff;color:#1e3a8a;font-weight:700}button[_ngcontent-%COMP%]{color:#1e3a8a;font-weight:500}"]})};var ia=["class","component"];function na(e,i){e&1&&(o(0,"div",4),C(1,"mat-progress-spinner",5),o(2,"p"),a(3,"Cargando \xF3rdenes entregadas..."),n()())}function oa(e,i){if(e&1){let t=x();o(0,"app-reporte-ordenes-table",8),_("verDetalles",function(s){D(t);let p=u(2);return v(p.onVerDetalles(s))})("verIncidencias",function(s){D(t);let p=u(2);return v(p.onVerIncidencias(s))}),n()}if(e&2){let t=u(2);d("ordenes",t.getOrdenesFiltradas())}}function aa(e,i){e&1&&(o(0,"div",7)(1,"h2"),a(2,"No hay \xD3rdenes Entregadas"),n(),o(3,"p"),a(4,"Ninguna orden ha sido marcada como 'Completada' en el sistema."),n()())}function ra(e,i){if(e&1&&S(0,oa,1,1,"app-reporte-ordenes-table",6)(1,aa,5,0,"div",7),e&2){let t=u();M(t.getOrdenesFiltradas()&&t.getOrdenesFiltradas().length>0?0:1)}}var nt=class e{constructor(i,t){this.distribucionService=i;this.router=t}ordenesEntregadas=null;isLoading=!0;filtroBusqueda="";ngOnInit(){this.cargarReporteOrdenes()}cargarReporteOrdenes(){this.isLoading=!0,this.distribucionService.getReporteOrdenesEntregadas().pipe(E(()=>this.isLoading=!1)).subscribe({next:i=>{this.ordenesEntregadas=i},error:i=>{console.error("Error al cargar reporte de \xF3rdenes:",i)}})}getOrdenesFiltradas(){if(!this.ordenesEntregadas)return null;if(!this.filtroBusqueda)return this.ordenesEntregadas;let i=this.filtroBusqueda.toLowerCase();return this.ordenesEntregadas.filter(t=>t.id.toString().includes(i)||t.nombreUsuario&&t.nombreUsuario.toLowerCase().includes(i)||t.area&&t.area.toLowerCase().includes(i))}onVerDetalles(i){this.router.navigate(["/GestionDistribucion/reportes/detalles",i])}onVerIncidencias(i){this.router.navigate(["/GestionDistribucion/reportes/incidencias",i])}static \u0275fac=function(t){return new(t||e)(h(I),h(ce))};static \u0275cmp=b({type:e,selectors:[["app-reportes-entrega-list",8,"component"]],standalone:!1,attrs:ia,decls:13,vars:2,consts:[[1,"page-container"],[1,"card-section"],[1,"search-bar"],["type","text","placeholder","Buscar por N\xB0 de Orden, Solicitante o \xC1rea",3,"ngModelChange","ngModel"],[1,"loading-state","centered-content"],["mode","indeterminate","diameter","50"],[3,"ordenes"],[1,"empty-state","centered-content"],[3,"verDetalles","verIncidencias","ordenes"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"h2"),a(2,"Reporte de \xD3rdenes de Distribuci\xF3n Entregadas"),n(),o(3,"mat-card",1)(4,"h3"),a(5,"\xD3rdenes cuyo estado es 'Completada' y requieren revisi\xF3n de incidencias."),n(),o(6,"div",2)(7,"h3"),a(8,"Buscar Orden Entregada"),n(),o(9,"input",3),le("ngModelChange",function(p){return re(r.filtroBusqueda,p)||(r.filtroBusqueda=p),p}),n()()(),o(10,"mat-card"),S(11,na,4,0,"div",4)(12,ra,2,1),n()()),t&2&&(l(9),ae("ngModel",r.filtroBusqueda),l(2),M(r.isLoading?11:12))},dependencies:[te,y,se,Q,de,it],encapsulation:2})};var la=[{path:"",component:Ee},{path:"asignacion",component:Ee},{path:"monitoreo",component:je},{path:"reportes",component:nt},{path:"vehiculos/lotes/:idSeguimiento",component:Xe},{path:"reportes/incidencias/:idOrden",component:Qe},{path:"reportes/detalles/:idOrden",component:tt}],ot=class e{static \u0275fac=function(t){return new(t||e)};static \u0275mod=Oe({type:e});static \u0275inj=Me({imports:[lt.forChild(la),lt]})};var Ht=class e{static \u0275fac=function(t){return new(t||e)};static \u0275mod=Oe({type:e});static \u0275inj=Me({imports:[Bt,Ft,ht,$t,ot,Pe,gt,Rt,Dt,Pt,xt,Et,Nt,Lt,yt,Pe,At]})};export{Ht as DistribucionModule};
